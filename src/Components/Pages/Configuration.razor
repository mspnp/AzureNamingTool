@page "/configuration"
@using AzureNamingTool.Helpers
@using AzureNamingTool.Models
@using AzureNamingTool.Services
@using AzureNamingTool.Services.Interfaces
@using System.IO
@using AzureNamingTool.Components.Modals;
@using BlazorDownloadFile
@using Microsoft.AspNetCore.Components.Authorization
@using System.Text.Json
@using System.Text.Json.Serialization
@using System.Text
@using System.Reflection;
@inject ILogger<Configuration> Logger
@inject IJSRuntime JsRuntime
@inject IConfiguration _config
@inject StateContainer state
@inject ProtectedSessionStorage session
@inject IToastService toastService
@implements IDisposable
@inject NavigationManager NavigationManager
@inject ServicesHelper ServicesHelper
@inject IHostApplicationLifetime AppLifetime

<PageTitle>Azure Naming Tool - Configuration</PageTitle>

<div class="modern-page-container">
    <div class="modern-page-title">
        <h1>Configuration</h1>
    </div>
    
    <div class="modern-page-description">
        <p>Customize the Azure Naming Tool configuration components and settings</p>
    </div>
    
    <div class="modern-page-actions">
        <button class="modern-btn-secondary" title="Instructions" @onclick="@(e => ModalHelper.ShowInformationModal(Modal!, theme, "bg-navcolor", "Configuration", String.Empty, "toolconfigurationinstructions", admin))">
            <span class="oi oi-document" aria-hidden="true"></span> Documentation
        </button>
        @if (admin)
        {
            <button class="modern-btn-secondary" title="Actions Legend" @onclick="@(e => ModalHelper.ShowInformationModal(Modal!, theme, "bg-navcolor", "Actions Legend", String.Empty, "actionslegendinstructions", admin))">
                <span class="oi oi-list" aria-hidden="true"></span> Actions Legend
            </button>
        }
        <button type="button" class="modern-btn-secondary" @onclick="@ExpandAll" title="Expand all sections">
            <span class="oi oi-fullscreen-enter" aria-hidden="true"></span> Expand All
        </button>
        <button type="button" class="modern-btn-secondary" @onclick="@CollapseAll" title="Collapse all sections">
            <span class="oi oi-fullscreen-exit" aria-hidden="true"></span> Collapse All
        </button>
    </div>
</div>

<div class="modern-admin-container">
    @if (admin)
        {
            @if ((!hasInternetConnectivity) && (!connectivityalertshown))
            {
                <div class="modern-alert modern-alert-danger mb-3">
                    <div class="modern-alert-header">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        <h4>ATTENTION</h4>
                    </div>
                    <div class="modern-alert-body">
                        <p>The Azure Naming Tool cannot verify internet connectivity, so some features have been disabled. This includes the ability to <span class="fw-bold">Refresh</span> resource types and locations.</p>
                        <p>Please check the <a href="/adminlog" class="fw-bold">Admin Log</a> for additional details.</p>
                        <p>You can disable the connectivity check in the <span class="fw-bold">Site Settings</span> section in the <a href="/admin" class="fw-bold">Admin</a> utility.</p>
                    </div>
                    <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => OnConnectivtyAlertDismissed())">
                        Dismiss
                    </button>
                </div>
            }
            @if ((!versionalertshown) && (!String.IsNullOrEmpty(versionalert)))
            {
                <div class="modern-notification-info" style="margin-bottom: 1rem;">
                    <i class="bi bi-info-circle"></i>
                    <div>
                        @((MarkupString)versionalert)
                        <div style="margin-top: 1rem; display: flex; justify-content: flex-end; align-items: center; gap: 1rem;">
                            <label class="modern-form-check">
                                <input type="checkbox" @bind="@dismissalert">
                                <span>Do not show again</span>
                            </label>
                            <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => OnConfigurationAlertDismissed())">
                                Dismiss
                            </button>
                        </div>
                    </div>
                </div>
            }
        }

        @if (!dataLoaded)
        {
            <div class="modern-loading">
                <div class="modern-spinner"></div>
                <p>Loading configuration data...</p>
            </div>
        }
        else
        {
            <!-- Base Configuration Section -->
            <div class="modern-section-title mb-3">
                <h2>Base Configuration</h2>
            </div>

            <div class="mb-3">
                @if (GeneralHelper.IsNotNull(servicesData))
                {
                    <!-- Components Card -->
                    <div class="modern-card mb-2" id="ResourceComponent">
                        <div class="modern-card-header collapsible @(GetCollapseClass("components"))" @onclick="@(() => ToggleCollapse("components"))">
                            <h3>
                                <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Components
                            </h3>
                        </div>
                        <div class="modern-card-body @(GetCollapseClass("components"))">
                            <!-- Current Components -->
                            <div class="modern-sub-card mb-2">
                                <h4 class="modern-subsection-title">
                                    Current Components
                                </h4>
                                <div class="modern-sub-card-body">
                                    <p>The current Components.</p>
                                    @if (admin)
                                    {
                                        <div class="mb-3">
                                            <button type="button" class="modern-btn-success" @onclick="@(e => FormAction("ResourceComponent",0,"add"))" title="Add Component">
                                                <span class="oi oi-plus" aria-hidden="true"></span> Add Component
                                            </button>
                                        </div>
                                        <div class="drag-hint">
                                            <span class="oi oi-move" aria-hidden="true"></span>
                                            Drag and drop rows to reorder components
                                        </div>
                                    }
                                    <div class="modern-table-container">
                                        <table class="modern-table">
                                            <thead>
                                                <tr>
                                                    @if (admin)
                                                    {
                                                        <th style="width: 40px;"></th>
                                                    }
                                                    <th>Name</th>
                                                    <th>Description</th>
                                                    @if (admin)
                                                    {
                                                        <th>Actions</th>
                                                    }
                                                </tr>
                                            </thead>
                                            <tbody id="resourceComponentsTableBody" @key="componentRenderKey">
                                                @foreach (var item in @servicesData.ResourceComponents!)
                                                {
                                                    <tr @key="item.Id" 
                                                        class="@GeneralHelper.SetTextEnabledClass(item.Enabled)"
                                                        draggable="@(admin ? "true" : "false")"
                                                        data-item-id="@item.Id">
                                                        @if (admin)
                                                        {
                                                            <td style="width: 40px; text-align: center;">
                                                                <span class="drag-handle oi oi-move" aria-hidden="true" title="Drag to reorder"></span>
                                                            </td>
                                                        }
                                                        <td class="w-30">
                                                            @item.DisplayName
                                                            @if (item.IsCustom)
                                                            {
                                                                <span class="modern-badge modern-badge-info ms-2">
                                                                    CUSTOM
                                                                </span>
                                                            }
                                                        </td>
                                                        <td class="w-30">
                                                            @item.Description
                                                        </td>
                                                        @if (admin)
                                                        {
                                                            <td>
                                                                <div class="modern-btn-group">
                                                                    <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => FormAction("ResourceComponent",item.Id,"edit"))" title="Edit">
                                                                        <span class="oi oi-pencil" aria-hidden="true"></span>
                                                                    </button>
                                                                    @if (item.Enabled)
                                                                    {
                                                                        <button type="button" class="modern-btn-dark modern-btn-sm" @onclick="@(e => FormAction("ResourceComponent",item.Id,"disable"))" title="Disable">
                                                                            <span class="oi oi-ban" aria-hidden="true"></span>
                                                                        </button>
                                                                    }
                                                                    else
                                                                    {
                                                                        <button type="button" class="modern-btn-success modern-btn-sm" @onclick="@(e => FormAction("ResourceComponent",item.Id,"enable"))" title="Enable">
                                                                            <span class="oi oi-plus" aria-hidden="true"></span>
                                                                        </button>
                                                                    }
                                                                    @if (item.IsCustom)
                                                                    {
                                                                        <button type="button" class="modern-btn-danger modern-btn-sm" @onclick="@(e => FormAction("ResourceComponent",item.Id,"delete"))" title="Delete">
                                                                            <span class="oi oi-x" aria-hidden="true"></span>
                                                                        </button>
                                                                    }
                                                                </div>
                                                            </td>
                                                        }
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            @if (admin)
                            {
                                <!-- Configuration Section -->
                                <div class="modern-sub-card">
                                    <div class="modern-sub-card-header collapsible @(GetCollapseClass("componentsconfig"))" @onclick="@(() => ToggleCollapse("componentsconfig"))">
                                        <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Configuration
                                    </div>
                                    <div class="modern-sub-card-body @(GetCollapseClass("componentsconfig"))">
                                        <div class="modern-notification-warning">
                                            <i class="bi bi-exclamation-triangle"></i>
                                            <div>
                                                <h4>Reset the Components Configuration</h4>
                                                <p>
                                                    Click <span class="fw-bold">Reset</span> to reset the Components Configuration back to the default values at the time of installation.
                                                </p>
                                                <p class="modern-text-warning">
                                                    <span class="fw-bold">NOTE:</span> This will reset the current Components Configuration and cannot be undone!
                                                </p>
                                                <p>
                                                    <button type="button" class="modern-btn-danger" @onclick=@(e => FormAction("ResourceComponent",0,"reset")) title="Reset">
                                                    <span class="oi oi-loop-circular" aria-hidden="true"></span> Reset
                                                </button>
                                            </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }

                @if (GeneralHelper.IsNotNull(servicesData!.ResourceDelimiters))
                {
                    <!-- Delimiters Card -->
                    <div class="modern-card mb-2" id="ResourceDelimiter">
                        <div class="modern-card-header collapsible @(GetCollapseClass("delimiters"))" @onclick="@(() => ToggleCollapse("delimiters"))">
                            <h3>
                                <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Delimiters
                            </h3>
                        </div>
                        <div class="modern-card-body @(GetCollapseClass("delimiters"))">
                            <!-- Current Delimiters -->
                            <div class="modern-sub-card mb-2">
                                <div class="modern-sub-card-header">
                                    Delimiter
                                </div>
                                <div class="modern-sub-card-body">
                                    <p>The current Delimiter.</p>
                                    <div class="modern-table-container">
                                        <table class="modern-table">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Delimiter</th>
                                                    @if (admin)
                                                    {
                                                        <th>Actions</th>
                                                    }
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in @servicesData.ResourceDelimiters)
                                                {
                                                    <tr class="@GeneralHelper.SetTextEnabledClass(item.Enabled)">
                                                        <td>@item.Name</td>
                                                        <td>@item.Delimiter</td>
                                                        @if (admin)
                                                        {
                                                            <td>
                                                                <div class="modern-btn-group">
                                                                    @if (!item.Enabled)
                                                                    {
                                                                        <button type="button" class="modern-btn-success modern-btn-sm" @onclick="@(e => FormAction("ResourceDelimiter",item.Id,"enable"))" title="Enable">
                                                                            <span class="oi oi-plus" aria-hidden="true"></span>
                                                                        </button>
                                                                    }
                                                                </div>
                                                            </td>
                                                        }
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            @if (admin)
                            {
                                <!-- Configuration Section -->
                                <div class="modern-sub-card">
                                    <div class="modern-sub-card-header collapsible @(GetCollapseClass("delimitersconfig"))" @onclick="@(() => ToggleCollapse("delimitersconfig"))">
                                        <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Configuration
                                    </div>
                                    <div class="modern-sub-card-body @(GetCollapseClass("delimitersconfig"))">
                                        <div class="modern-notification-warning">
                                            <i class="bi bi-exclamation-triangle"></i>
                                            <div>
                                                <h4>Reset the Delimiters Configuration</h4>
                                                <p>
                                                    Click <span class="fw-bold">Reset</span> to reset the Delimiters Configuration back to the default values at the time of installation.
                                                </p>
                                                <p class="modern-text-warning">
                                                    <span class="fw-bold">NOTE:</span> This will reset the current Delimiters Configuration and cannot be undone!
                                                </p>
                                            <p>
                                                <button type="button" class="modern-btn-danger" @onclick=@(e => FormAction("ResourceDelimiter",0,"reset")) title="Reset">
                                                    <span class="oi oi-loop-circular" aria-hidden="true"></span> Reset
                                                </button>
                                            </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>

            <!-- Component Configuration Section -->
            <div class="modern-section-title mb-3">
                <h2>Component Configuration</h2>
            </div>

            <div class="mb-3">
                @if (servicesData.ResourceComponents!.Where(x => x.IsCustom == true).Count() > 0)
                {
                    <!-- Custom Components Card -->
                    <div class="modern-card mb-2">
                        <div class="modern-card-header collapsible @(GetCollapseClass("customcomponents"))" @onclick="@(() => ToggleCollapse("customcomponents"))">
                            <h3>
                                <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Custom Components
                            </h3>
                        </div>
                        <div class="modern-card-body @(GetCollapseClass("customcomponents"))">
                            @foreach (ResourceComponent customComponent in servicesData.ResourceComponents!.Where(x => x.IsCustom == true))
                            {
                                @if ((GeneralHelper.IsNotNull(servicesData.CustomComponents!.Where(x => x.ParentComponent == GeneralHelper.NormalizeName(customComponent.Name, true)))) && (customComponent.Name != "ResourceInstance"))
                                {
                                    <div class="modern-sub-card mb-2">
                                        <div class="modern-sub-card-header collapsible @(GetCollapseClass("custom" + customComponent.Id.ToString()))" @onclick="@(() => ToggleCollapse("custom" + customComponent.Id.ToString()))">
                                            <span class="oi oi-chevron-bottom" aria-hidden="true"></span> @customComponent.Name
                                        </div>
                                        @if (!customComponent.IsFreeText)
                                        {
                                            <div class="modern-sub-card-body @(GetCollapseClass("custom" + customComponent.Id.ToString()))">
                                                @if (!String.IsNullOrEmpty(customComponent.Description))
                                                {
                                                    <p>@customComponent.Description</p>
                                                }
                                                <div class="modern-sub-card mb-2">
                                                    <div class="modern-sub-card-header">
                                                        Current Components
                                                    </div>
                                                    <div class="modern-sub-card-body">
                                                        <p>The current Components.</p>
                                                        @if (admin)
                                                        {
                                                            <div class="mb-3">
                                                                <button type="button" class="modern-btn-success" @onclick="@(e => FormAction("CustomComponent",0,"add", customComponent.Name))" title="@("Add " + customComponent.Name)">
                                                                    <span class="oi oi-plus" aria-hidden="true"></span> Add Component
                                                                </button>
                                                            </div>
                                                            <div class="drag-hint">
                                                                <span class="oi oi-move" aria-hidden="true"></span>
                                                                Drag and drop rows to reorder
                                                            </div>
                                                        }
                                                        <div class="modern-table-container">
                                                            <table class="modern-table">
                                                                <thead>
                                                                    <tr>
                                                                        @if (admin)
                                                                        {
                                                                            <th style="width: 40px;"></th>
                                                                        }
                                                                        <th>Name</th>
                                                                        <th>Short Name</th>
                                                                        @if (admin)
                                                                        {
                                                                            <th>Actions</th>
                                                                        }
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="customComponent@(customComponent.Id)TableBody">
                                                                    @foreach (var item in @servicesData.CustomComponents!.Where(x => x.ParentComponent == GeneralHelper.NormalizeName(customComponent.Name, true)).OrderBy(x => x.SortOrder))
                                                                    {
                                                                        <tr draggable="@(admin ? "true" : "false")"
                                                                            data-item-id="@item.Id">
                                                                            @if (admin)
                                                                            {
                                                                                <td style="width: 40px; text-align: center;">
                                                                                    <span class="drag-handle oi oi-move" aria-hidden="true" title="Drag to reorder"></span>
                                                                                </td>
                                                                            }
                                                                            <td>@item.Name</td>
                                                                            <td>@item.ShortName</td>
                                                                            @if (admin)
                                                                            {
                                                                                <td>
                                                                                    <div class="modern-btn-group">
                                                                                        <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => FormAction("CustomComponent",item.Id,"edit"))" title="Edit">
                                                                                            <span class="oi oi-pencil" aria-hidden="true"></span>
                                                                                        </button>
                                                                                        @if (servicesData.CustomComponents!.Where(x => x.ParentComponent == GeneralHelper.NormalizeName(customComponent.Name, true)).Count() > 1)
                                                                                        {
                                                                                            <button type="button" class="modern-btn-danger modern-btn-sm" @onclick="@(e => FormAction("CustomComponent",item.Id,"delete"))" title="Delete">
                                                                                                <span class="oi oi-x" aria-hidden="true"></span>
                                                                                            </button>
                                                                                        }
                                                                                    </div>
                                                                                </td>
                                                                            }
                                                                        </tr>
                                                                    }
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                @if (admin)
                                                {
                                                    <div class="modern-sub-card">
                                                        <div class="modern-sub-card-header">
                                                            Bulk Update
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Use the options below to bulk update all component options.
                                                            </p>
                                                            <div class="modern-btn-group">
                                                                <button type="button" class="modern-btn-success" @onclick=@(e => FormAction("CustomComponent",0,"uppercase", customComponent.Name)) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-top" aria-hidden="true"></span> Convert to Uppercase
                                                                </button>
                                                                <button type="button" class="modern-btn-success" @onclick=@(e => FormAction("CustomComponent",0,"lowercase", customComponent.Name)) title="Lowercase">
                                                                    <span class="oi oi-arrow-thick-bottom" aria-hidden="true"></span> Convert to Lowercase
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="modern-sub-card-body @(GetCollapseClass("custom" + customComponent.Id.ToString()))">
                                                <p class="modern-text-info" style="font-style:italic;">This is a Free Form Text field component and has no configurable options.</p>
                                            </div>
                                        }
                                    </div>
                                }
                            }

                            @if (admin)
                            {
                                <div class="modern-sub-card">
                                    <div class="modern-sub-card-header collapsible @(GetCollapseClass("customcomponentconfig"))" @onclick="@(() => ToggleCollapse("customcomponentconfig"))">
                                        <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Configuration
                                    </div>
                                    <div class="modern-sub-card-body @(GetCollapseClass("customcomponentconfig"))">
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }
                @foreach (ResourceComponent resourceComponent in servicesData.ResourceComponents!.OrderBy(x => x.Name))
                {
                    switch (resourceComponent.Name)
                    {
                        case "ResourceEnvironment":
                            @if (GeneralHelper.IsNotNull(servicesData.ResourceEnvironments))
                            {
                                <!-- Environments Card -->
                                <div class="modern-card mb-2" id="@resourceComponent.Name">
                                    <div class="modern-card-header collapsible @(GetCollapseClass("environments"))" @onclick="@(() => ToggleCollapse("environments"))">
                                        <h3>
                                            <span class="oi oi-chevron-bottom" aria-hidden="true"></span> @resourceComponent.DisplayName
                                        </h3>
                                    </div>
                                    <div class="modern-card-body @(GetCollapseClass("environments"))">
                                        @if (!String.IsNullOrEmpty(resourceComponent.Description))
                                        {
                                            <p>@resourceComponent.Description</p>
                                        }
                                        <!-- Current Environments -->
                                        <div class="modern-sub-card mb-2">
                                            <div class="modern-sub-card-header">
                                                Current Environments
                                            </div>
                                            <div class="modern-sub-card-body">
                                                <p>The current Environments.</p>
                                                @if (admin)
                                                {
                                                    <div class="mb-3">
                                                        <button type="button" class="modern-btn-success" @onclick="@(e => FormAction("ResourceEnvironment",0,"add"))" title="Add Environment">
                                                            <span class="oi oi-plus" aria-hidden="true"></span> Add Environment
                                                        </button>
                                                    </div>
                                                    <div class="drag-hint">
                                                        <span class="oi oi-move" aria-hidden="true"></span>
                                                        Drag and drop rows to reorder
                                                    </div>
                                                }
                                                <div class="modern-table-container">
                                                    <table class="modern-table">
                                                        <thead>
                                                            <tr>
                                                                @if (admin)
                                                                {
                                                                    <th style="width: 40px;"></th>
                                                                }
                                                                <th>Name</th>
                                                                <th>Short Name</th>
                                                                @if (admin)
                                                                {
                                                                    <th>Actions</th>
                                                                }
                                                            </tr>
                                                        </thead>
                                                        <tbody id="resourceEnvironmentsTableBody" @key="environmentRenderKey">
                                                            @foreach (var item in @servicesData.ResourceEnvironments)
                                                            {
                                                                <tr @key="item.Id"
                                                                    draggable="@(admin ? "true" : "false")"
                                                                    data-item-id="@item.Id">
                                                                    @if (admin)
                                                                    {
                                                                        <td style="width: 40px; text-align: center;">
                                                                            <span class="drag-handle oi oi-move" aria-hidden="true" title="Drag to reorder"></span>
                                                                        </td>
                                                                    }
                                                                    <td>@item.Name</td>
                                                                    <td>@item.ShortName</td>
                                                                    @if (admin)
                                                                    {
                                                                        <td>
                                                                            <div class="modern-btn-group">
                                                                                <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => FormAction("ResourceEnvironment",item.Id,"edit"))" title="Edit">
                                                                                    <span class="oi oi-pencil" aria-hidden="true"></span>
                                                                                </button>
                                                                                @if (servicesData.ResourceEnvironments.Count > 1)
                                                                                {
                                                                                    <button type="button" class="modern-btn-danger modern-btn-sm" @onclick="@(e => FormAction("ResourceEnvironment",item.Id,"delete"))" title="Delete">
                                                                                        <span class="oi oi-x" aria-hidden="true"></span>
                                                                                    </button>
                                                                                }
                                                                            </div>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        @if (admin)
                                        {
                                            <!-- Configuration Section -->
                                            <div class="modern-sub-card">
                                                <div class="modern-sub-card-header collapsible @(GetCollapseClass("environmentsconfig"))" @onclick="@(() => ToggleCollapse("environmentsconfig"))">
                                                    <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Configuration
                                                </div>
                                                <div class="modern-sub-card-body @(GetCollapseClass("environmentsconfig"))">
                                                    <div class="modern-sub-card mb-2">
                                                        <div class="modern-sub-card-header">
                                                            Bulk Update
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Use the options below to bulk update all component options.
                                                            </p>
                                                            <div class="modern-btn-group">
                                                                <button type="button" class="modern-btn-success" @onclick=@(e => FormAction(resourceComponent.Name,0,"uppercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-top" aria-hidden="true"></span> Convert to Uppercase
                                                                </button>
                                                                <button type="button" class="modern-btn-success" @onclick=@(e => FormAction(resourceComponent.Name,0,"lowercase")) title="Lowercase">
                                                                    <span class="oi oi-arrow-thick-bottom" aria-hidden="true"></span> Convert to Lowercase
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modern-notification-warning">
                                                        <i class="bi bi-exclamation-triangle"></i>
                                                        <div>
                                                            <h4>Reset the Environments Configuration</h4>
                                                            <p>
                                                                Click <span class="fw-bold">Reset</span> to reset the Environments Configuration back to the default values at the time of installation.
                                                            </p>
                                                            <p class="modern-text-warning">
                                                                <span class="fw-bold">NOTE:</span> This will reset the current Environments Configuration and cannot be undone!
                                                            </p>
                                                        <p>
                                                            <button type="button" class="modern-btn-danger" @onclick=@(e => FormAction("ResourceEnvironment",0,"reset")) title="Reset">
                                                                <span class="oi oi-loop-circular" aria-hidden="true"></span> Reset
                                                            </button>
                                                        </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                            break;
                        case "ResourceFunction":
                            @if (GeneralHelper.IsNotNull(servicesData.ResourceFunctions))
                            {
                                <!-- Functions Card -->
                                <div class="modern-card mb-2" id="@resourceComponent.Name">
                                    <div class="modern-card-header collapsible @(GetCollapseClass("functions"))" @onclick="@(() => ToggleCollapse("functions"))">
                                        <h3>
                                            <span class="oi oi-chevron-bottom" aria-hidden="true"></span> @resourceComponent.DisplayName
                                        </h3>
                                    </div>
                                    <div class="modern-card-body @(GetCollapseClass("functions"))">
                                        @if (!String.IsNullOrEmpty(resourceComponent.Description))
                                        {
                                            <p>@resourceComponent.Description</p>
                                        }
                                        <!-- Current Functions -->
                                        <div class="modern-sub-card mb-2">
                                            <div class="modern-sub-card-header">
                                                Current Functions
                                            </div>
                                            <div class="modern-sub-card-body">
                                                <p>The current Functions.</p>
                                                @if (admin)
                                                {
                                                    <div class="mb-3">
                                                        <button type="button" class="modern-btn-success" @onclick="@(e => FormAction("ResourceFunction",0,"add"))" title="Add Function">
                                                            <span class="oi oi-plus" aria-hidden="true"></span> Add Function
                                                        </button>
                                                    </div>
                                                    <div class="drag-hint">
                                                        <span class="oi oi-move" aria-hidden="true"></span>
                                                        Drag and drop rows to reorder
                                                    </div>
                                                }
                                                <div class="modern-table-container">
                                                    <table class="modern-table">
                                                        <thead>
                                                            <tr>
                                                                @if (admin)
                                                                {
                                                                    <th style="width: 40px;"></th>
                                                                }
                                                                <th>Name</th>
                                                                <th>Short Name</th>
                                                                @if (admin)
                                                                {
                                                                    <th>Actions</th>
                                                                }
                                                            </tr>
                                                        </thead>
                                                        <tbody id="resourceFunctionsTableBody">
                                                            @foreach (var item in @servicesData.ResourceFunctions!.OrderBy(x => x.SortOrder))
                                                            {
                                                                <tr draggable="@(admin ? "true" : "false")"
                                                                    data-item-id="@item.Id">
                                                                    @if (admin)
                                                                    {
                                                                        <td style="width: 40px; text-align: center;">
                                                                            <span class="drag-handle oi oi-move" aria-hidden="true" title="Drag to reorder"></span>
                                                                        </td>
                                                                    }
                                                                    <td>@item.Name</td>
                                                                    <td>@item.ShortName</td>
                                                                    @if (admin)
                                                                    {
                                                                        <td>
                                                                            <div class="modern-btn-group">
                                                                                <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => FormAction("ResourceFunction",item.Id,"edit"))" title="Edit">
                                                                                    <span class="oi oi-pencil" aria-hidden="true"></span>
                                                                                </button>
                                                                                @if (servicesData.ResourceFunctions.Count > 1)
                                                                                {
                                                                                    <button type="button" class="modern-btn-danger modern-btn-sm" @onclick="@(e => FormAction("ResourceFunction",item.Id,"delete"))" title="Delete">
                                                                                        <span class="oi oi-x" aria-hidden="true"></span>
                                                                                    </button>
                                                                                }
                                                                            </div>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        @if (admin)
                                        {
                                            <!-- Configuration Section -->
                                            <div class="modern-sub-card">
                                                <div class="modern-sub-card-header collapsible @(GetCollapseClass("functionsconfig"))" @onclick="@(() => ToggleCollapse("functionsconfig"))">
                                                    <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Configuration
                                                </div>
                                                <div class="modern-sub-card-body @(GetCollapseClass("functionsconfig"))">
                                                    <div class="modern-sub-card mb-2">
                                                        <div class="modern-sub-card-header">
                                                            Bulk Update
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Use the options below to bulk update all component options.
                                                            </p>
                                                            <div class="modern-btn-group">
                                                                <button type="button" class="modern-btn-success" @onclick=@(e => FormAction(resourceComponent.Name,0,"uppercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-top" aria-hidden="true"></span> Convert to Uppercase
                                                                </button>
                                                                <button type="button" class="modern-btn-success" @onclick=@(e => FormAction(resourceComponent.Name,0,"lowercase")) title="Lowercase">
                                                                    <span class="oi oi-arrow-thick-bottom" aria-hidden="true"></span> Convert to Lowercase
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modern-warning-box">
                                                        <h4>Reset the Functions Configuration</h4>
                                                        <p>
                                                            Click <span class="fw-bold">Reset</span> to reset the Functions Configuration back to the default values at the time of installation.
                                                        </p>
                                                        <p class="modern-text-warning">
                                                            <span class="fw-bold">NOTE:</span> This will reset the current Functions configuration and cannot be undone!
                                                        </p>
                                                        <p>
                                                            <button type="button" class="modern-btn-danger" @onclick=@(e => FormAction("ResourceFunction",0,"reset")) title="Reset">
                                                                <span class="oi oi-loop-circular" aria-hidden="true"></span> Reset
                                                            </button>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                            break;
                        case "ResourceLocation":
                            @if (GeneralHelper.IsNotNull(servicesData.ResourceLocations))
                            {
                                <!-- Locations Card -->
                                <div class="modern-card mb-2" id="@resourceComponent.Name">
                                    <div class="modern-card-header collapsible @(GetCollapseClass("locations"))" @onclick="@(() => ToggleCollapse("locations"))">
                                        <h3>
                                            <span class="oi oi-chevron-bottom" aria-hidden="true"></span> @resourceComponent.DisplayName
                                        </h3>
                                    </div>
                                    <div class="modern-card-body @(GetCollapseClass("locations"))">
                                        @if (!String.IsNullOrEmpty(resourceComponent.Description))
                                        {
                                            <p>@resourceComponent.Description</p>
                                        }
                                        <!-- Current Locations -->
                                        <div class="modern-sub-card mb-2">
                                            <div class="modern-sub-card-header">
                                                Current Locations
                                            </div>
                                            <div class="modern-sub-card-body">
                                                <p>The current Locations.</p>
                                                @if (admin)
                                                {
                                                    <div class="mb-3">
                                                        <button type="button" class="modern-btn-success" @onclick="@(e => FormAction("ResourceLocation",0,"add"))" title="Add Location">
                                                            <span class="oi oi-plus" aria-hidden="true"></span> Add Location
                                                        </button>
                                                    </div>
                                                }
                                                <div class="modern-table-container">
                                                    <table class="modern-table">
                                                        <thead>
                                                            <tr>
                                                                <th>Name</th>
                                                                <th>Short Name</th>
                                                                @if (admin)
                                                                {
                                                                    <th>Actions</th>
                                                                }
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (var item in @servicesData.ResourceLocations)
                                                            {
                                                                <tr class="@GeneralHelper.SetTextEnabledClass(item.Enabled)">
                                                                    <td>@item.Name</td>
                                                                    <td>@item.ShortName</td>
                                                                    @if (admin)
                                                                    {
                                                                        <td>
                                                                            <div class="modern-btn-group">
                                                                                <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => FormAction("ResourceLocation",item.Id,"edit"))" title="Edit">
                                                                                    <span class="oi oi-pencil" aria-hidden="true"></span>
                                                                                </button>
                                                                                @if (servicesData.ResourceLocations.Count > 1)
                                                                                {
                                                                                    @if (item.Enabled)
                                                                                    {
                                                                                        <button type="button" class="modern-btn-dark modern-btn-sm" @onclick="@(e => FormAction("ResourceLocation",item.Id,"disable"))" title="Disable">
                                                                                            <span class="oi oi-ban" aria-hidden="true"></span>
                                                                                        </button>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <button type="button" class="modern-btn-success modern-btn-sm" @onclick="@(e => FormAction("ResourceLocation",item.Id,"enable"))" title="Enable">
                                                                                            <span class="oi oi-plus" aria-hidden="true"></span>
                                                                                        </button>
                                                                                    }
                                                                                    <button type="button" class="modern-btn-danger modern-btn-sm" @onclick="@(e => FormAction("ResourceLocation",item.Id,"delete"))" title="Delete">
                                                                                        <span class="oi oi-x" aria-hidden="true"></span>
                                                                                    </button>
                                                                                }
                                                                            </div>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        @if (admin)
                                        {
                                            <!-- Configuration Section -->
                                            <div class="modern-sub-card">
                                                <div class="modern-sub-card-header collapsible @(GetCollapseClass("locationsconfig"))" @onclick="@(() => ToggleCollapse("locationsconfig"))">
                                                    <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Configuration
                                                </div>
                                                <div class="modern-sub-card-body @(GetCollapseClass("locationsconfig"))">
                                                    <div class="modern-sub-card mb-2">
                                                        <div class="modern-sub-card-header">
                                                            Bulk Update
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Use the options below to bulk update all component options.
                                                            </p>
                                                            <div class="modern-btn-group">
                                                                <button type="button" class="modern-btn-success" @onclick=@(e => FormAction(resourceComponent.Name,0,"uppercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-top" aria-hidden="true"></span> Convert to Uppercase
                                                                </button>
                                                                <button type="button" class="modern-btn-success" @onclick=@(e => FormAction(resourceComponent.Name,0,"lowercase")) title="Lowercase">
                                                                    <span class="oi oi-arrow-thick-bottom" aria-hidden="true"></span> Convert to Lowercase
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    @if (ConfigurationHelper.VerifyConnectivity().Result)
                                                    {
                                                        <div class="modern-info-box mb-3">
                                                            <h4>Refresh the Resource Locations Configuration</h4>
                                                            <p>
                                                                Click <span class="fw-bold">Refresh</span> to download the latest Resource Locations Configuration file from the Azure Naming Tool GitHub repository.
                                                            </p>
                                                            <p>
                                                                <span class="fw-bold">NOTES:</span>
                                                                <ul>
                                                                    <li>This will refresh the current Locations Configuration and cannot be undone!</li>
                                                                    <li>New location configurations will be added.</li>
                                                                    @if (refreshlocationshortnames)
                                                                    {
                                                                        <li>All location configurations will be updated.</li>
                                                                        <li><span class="modern-text-danger fw-bold">Any customized short names will be overwritten.</span></li>
                                                                    }
                                                                    else
                                                                    {
                                                                        <li>
                                                                            All of the existing Location configurations will be retained.
                                                                        </li>
                                                                    }
                                                                </ul>
                                                                <div class="modern-alert modern-alert-warning">
                                                                    <div class="modern-alert-body">
                                                                        <span class="fw-bold">NOTE</span><br />
                                                                        This action may result in duplicate locations if you have added a custom location that matches the incoming values.
                                                                    </div>
                                                                </div>
                                                            </p>
                                                            <div class="modern-btn-group">
                                                                <button type="button" class="modern-btn-success" @onclick=@(e => FormAction("ResourceLocation",0,"refresh")) title="Refresh">
                                                                    <span class="oi oi-reload" aria-hidden="true"></span> Refresh
                                                                </button>
                                                                <label class="modern-form-check">
                                                                    <input type="checkbox" @onchange="@((ChangeEventArgs e) =>OnRefreshLocationsCheckboxClicked(e))">
                                                                    <span>Refresh short names?</span>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    }
                                                    <div class="modern-warning-box">
                                                        <h4>Reset the Locations Configuration</h4>
                                                        <p>
                                                            Click <span class="fw-bold">Reset</span> to reset the Locations Configuration back to the default values at the time of installation.
                                                        </p>
                                                        <p class="modern-text-warning">
                                                            <span class="fw-bold">NOTE:</span> This will reset the current Locations Configuration and cannot be undone!
                                                        </p>
                                                        <p>
                                                            <button type="button" class="modern-btn-danger" @onclick=@(e => FormAction("ResourceLocation",0,"reset")) title="Reset">
                                                                <span class="oi oi-loop-circular" aria-hidden="true"></span> Reset
                                                            </button>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                            break;
                        case "ResourceOrg":
                            @if (GeneralHelper.IsNotNull(servicesData.ResourceOrgs))
                            {
                                <!-- Orgs Card -->
                                <div class="modern-card mb-2" id="@resourceComponent.Name">
                                    <div class="modern-card-header collapsible @(GetCollapseClass("orgs"))" @onclick="@(() => ToggleCollapse("orgs"))">
                                        <h3>
                                            <span class="oi oi-chevron-bottom" aria-hidden="true"></span> @resourceComponent.DisplayName
                                        </h3>
                                    </div>
                                    <div class="modern-card-body @(GetCollapseClass("orgs"))">
                                        @if (!String.IsNullOrEmpty(resourceComponent.Description))
                                        {
                                            <p>@resourceComponent.Description</p>
                                        }
                                        <div class="modern-sub-card mb-2">
                                            <div class="modern-sub-card-header">
                                                Current Orgs
                                            </div>
                                            <div class="modern-sub-card-body">
                                                <p>The current Orgs.</p>
                                                @if (admin)
                                                {
                                                    <p>
                                                        <button type="button" class="modern-btn-success modern-btn-sm" @onclick="@(e => FormAction("ResourceOrg",0,"add"))" title="Add Org">
                                                            <span class="oi oi-plus" aria-hidden="true"></span> Add Org
                                                        </button>
                                                    </p>
                                                    <div class="drag-hint">
                                                        <span class="oi oi-move" aria-hidden="true"></span>
                                                        Drag and drop rows to reorder
                                                    </div>
                                                }
                                                <div class="modern-table-container">
                                                    <table class="modern-table">
                                                        <thead>
                                                            <tr>
                                                                @if (admin)
                                                                {
                                                                    <th style="width: 40px;"></th>
                                                                }
                                                                <th>Name</th>
                                                                <th>Short Name</th>
                                                                @if (admin)
                                                                {
                                                                    <th>Actions</th>
                                                                }
                                                            </tr>
                                                        </thead>
                                                        <tbody id="resourceOrgsTableBody">
                                                            @foreach (var item in @servicesData.ResourceOrgs!.OrderBy(x => x.SortOrder))
                                                            {
                                                                <tr draggable="@(admin ? "true" : "false")"
                                                                    data-item-id="@item.Id">
                                                                    @if (admin)
                                                                    {
                                                                        <td style="width: 40px; text-align: center;">
                                                                            <span class="drag-handle oi oi-move" aria-hidden="true" title="Drag to reorder"></span>
                                                                        </td>
                                                                    }
                                                                    <td>@item.Name</td>
                                                                    <td>@item.ShortName</td>
                                                                    @if (admin)
                                                                    {
                                                                        <td>
                                                                            <div class="modern-btn-group">
                                                                                <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => FormAction("ResourceOrg",item.Id,"edit"))" title="Edit">
                                                                                    <span class="oi oi-pencil" aria-hidden="true"></span>
                                                                                </button>
                                                                                @if (servicesData.ResourceOrgs.Count > 1)
                                                                                {
                                                                                    <button type="button" class="modern-btn-danger modern-btn-sm" @onclick="@(e => FormAction("ResourceOrg",item.Id,"delete"))" title="Delete">
                                                                                        <span class="oi oi-x" aria-hidden="true"></span>
                                                                                    </button>
                                                                                }
                                                                            </div>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        @if (admin)
                                        {
                                            <div class="modern-sub-card mb-2">
                                                <div class="modern-sub-card-header collapsible @(GetCollapseClass("orgsconfig"))" @onclick="@(() => ToggleCollapse("orgsconfig"))">
                                                    <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Configuration
                                                </div>
                                                <div class="modern-sub-card-body @(GetCollapseClass("orgsconfig"))">
                                                    <div class="modern-sub-card mb-2">
                                                        <div class="modern-sub-card-header">
                                                            Bulk Update
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Use the options below to bulk update all component options.
                                                            </p>
                                                            <p>
                                                                <button type="button" class="modern-btn-success modern-btn-sm" @onclick=@(e => FormAction(resourceComponent.Name,0,"uppercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-top" aria-hidden="true"></span> Convert to Uppercase
                                                                </button>
                                                                <button type="button" class="modern-btn-success modern-btn-sm" @onclick=@(e => FormAction(resourceComponent.Name,0,"lowercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-bottom" aria-hidden="true"></span> Convert to Lowercase
                                                                </button>
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="modern-warning-box mb-3">
                                                        <div class="modern-sub-card-header">
                                                            Reset the Orgs Configuration
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Click <span class="fw-bold">Reset</span> to reset the Orgs Configuration back to the default values at the time of installation.
                                                            </p>
                                                            <p>
                                                                <span class="fw-bold">NOTE:</span> This will reset the current Orgs Configuration and cannot be undone!
                                                            </p>
                                                            <p>
                                                                <button type="button" class="modern-btn-danger modern-btn-sm" @onclick=@(e => FormAction("ResourceOrg",0,"reset")) title="Reset">
                                                                    <span class="oi oi-loop-circular" aria-hidden="true"></span> Reset
                                                                </button>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                            break;
                        case "ResourceProjAppSvc":
                            @if (GeneralHelper.IsNotNull(servicesData.ResourceProjAppSvcs))
                            {
                                <div class="modern-card mb-2" id="@resourceComponent.Name">
                                    <div class="modern-card-header collapsible @(GetCollapseClass("projsappssvcs"))" @onclick="@(() => ToggleCollapse("projsappssvcs"))">
                                        <h3 class="modern-card-title">
                                            <span class="oi oi-chevron-bottom" aria-hidden="true"></span> @resourceComponent.DisplayName
                                        </h3>
                                    </div>
                                    <div class="modern-card-body @(GetCollapseClass("projsappssvcs"))">
                                        @if (!String.IsNullOrEmpty(resourceComponent.Description))
                                        {
                                            <p>@resourceComponent.Description</p>
                                        }
                                        <div class="modern-sub-card mb-2">
                                            <div class="modern-sub-card-header">
                                                Current Projects/Apps/Services
                                            </div>
                                            <div class="modern-sub-card-body">
                                                <p>The current Projects/Apps/Services.</p>
                                                @if (admin)
                                                {
                                                    <p>
                                                        <button type="button" class="modern-btn-success modern-btn-sm" @onclick="@(e => FormAction("ResourceProjAppSvc",0,"add"))" title="Add Project/App/Service">
                                                            <span class="oi oi-plus" aria-hidden="true"></span> Add Project/App/Service
                                                        </button>
                                                    </p>
                                                    <div class="drag-hint">
                                                        <span class="oi oi-move" aria-hidden="true"></span>
                                                        Drag and drop rows to reorder
                                                    </div>
                                                }
                                                <div class="modern-table-container">
                                                    <table class="modern-table">
                                                        <thead>
                                                            <tr>
                                                                @if (admin)
                                                                {
                                                                    <th style="width: 40px;"></th>
                                                                }
                                                                <th>Name</th>
                                                                <th>Short Name</th>
                                                                @if (admin)
                                                                {
                                                                    <th>Actions</th>
                                                                }
                                                            </tr>
                                                        </thead>
                                                        <tbody id="resourceProjAppSvcsTableBody">
                                                            @foreach (var item in @servicesData.ResourceProjAppSvcs!.OrderBy(x => x.SortOrder))
                                                            {
                                                                <tr draggable="@(admin ? "true" : "false")"
                                                                    data-item-id="@item.Id">
                                                                    @if (admin)
                                                                    {
                                                                        <td style="width: 40px; text-align: center;">
                                                                            <span class="drag-handle oi oi-move" aria-hidden="true" title="Drag to reorder"></span>
                                                                        </td>
                                                                    }
                                                                    <td>@item.Name</td>
                                                                    <td>@item.ShortName</td>
                                                                    @if (admin)
                                                                    {
                                                                        <td>
                                                                            <div class="modern-btn-group">
                                                                                <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => FormAction("ResourceProjAppSvc",item.Id,"edit"))" title="Edit">
                                                                                    <span class="oi oi-pencil" aria-hidden="true"></span>
                                                                                </button>
                                                                                @if (servicesData.ResourceProjAppSvcs.Count > 1)
                                                                                {
                                                                                    <button type="button" class="modern-btn-danger modern-btn-sm" @onclick="@(e => FormAction("ResourceProjAppSvc",item.Id,"delete"))" title="Delete">
                                                                                        <span class="oi oi-x" aria-hidden="true"></span>
                                                                                    </button>
                                                                                }
                                                                            </div>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        @if (admin)
                                        {
                                            <div class="modern-sub-card mb-2">
                                                <div class="modern-sub-card-header collapsible @(GetCollapseClass("projappsvcsconfig"))" @onclick="@(() => ToggleCollapse("projappsvcsconfig"))">
                                                    <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Configuration
                                                </div>
                                                <div class="modern-sub-card-body @(GetCollapseClass("projappsvcsconfig"))">
                                                    <div class="modern-sub-card mb-2">
                                                        <div class="modern-sub-card-header">
                                                            Bulk Update
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Use the options below to bulk update all component options.
                                                            </p>
                                                            <p>
                                                                <button type="button" class="modern-btn-success modern-btn-sm" @onclick=@(e => FormAction(resourceComponent.Name,0,"uppercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-top" aria-hidden="true"></span> Convert to Uppercase
                                                                </button>
                                                                <button type="button" class="modern-btn-success modern-btn-sm" @onclick=@(e => FormAction(resourceComponent.Name,0,"lowercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-bottom" aria-hidden="true"></span> Convert to Lowercase
                                                                </button>
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="modern-warning-box mb-3">
                                                        <div class="modern-sub-card-header">
                                                            Reset the Projects/Apps/Services Configuration
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Click <span class="fw-bold">Reset</span> to reset the Project/App/Services Configuration back to the default values at the time of installation.
                                                            </p>
                                                            <p>
                                                                <span class="fw-bold">NOTE:</span> This will reset the current Project/App/Services Configuration and cannot be undone!
                                                            </p>
                                                            <p>
                                                                <button type="button" class="modern-btn-danger modern-btn-sm" @onclick=@(e => FormAction("ResourceProjAppSvc",0,"reset")) title="Reset">
                                                                    <span class="oi oi-loop-circular" aria-hidden="true"></span> Reset
                                                                </button>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                            break;
                        case "ResourceType":
                            @if (GeneralHelper.IsNotNull(servicesData.ResourceTypes))
                            {
                                <div class="modern-card mb-2" id="@resourceComponent.Name">
                                    <div class="modern-card-header collapsible @(GetCollapseClass("types"))" @onclick="@(() => ToggleCollapse("types"))">
                                        <h3 class="modern-card-title">
                                            <span class="oi oi-chevron-bottom" aria-hidden="true"></span> @resourceComponent.DisplayName
                                        </h3>
                                    </div>
                                    <div class="modern-card-body @(GetCollapseClass("types"))">
                                        @if (!String.IsNullOrEmpty(resourceComponent.Description))
                                        {
                                            <p>@resourceComponent.Description</p>
                                        }
                                        <div class="modern-sub-card mb-2">
                                            <div class="modern-sub-card-header">
                                                Current Resource Types
                                            </div>
                                            <div class="modern-sub-card-body">
                                                <p>The current Resource Types.</p>
                                                <p>
                                                    Use the filters below to jump to a specifc resource type.
                                                </p>
                                                <p>
                                                    <select @onchange="OnCategoryChanged" class="form-control @theme.ThemeStyle">
                                                        <option value="">Select a resource type provider (OPTIONAL)</option>
                                                        @foreach (var category in @categories)
                                                        {
                                                            <option value="@category">@category</option>
                                                        }
                                                    </select>
                                                    <select @onchange="OnTypeChanged" class="form-control @theme.ThemeStyle">
                                                        <option value="">Select a resource type</option>
                                                        @foreach (var type in @ResourceTypeService.GetFilteredResourceTypes(servicesData.ResourceTypes, selectedResourceTypeCategory))
                                                        {
                                                            @if (!String.IsNullOrEmpty(type.Property))
                                                            {
                                                                <option value="@type.Id">@type.Resource - @type.Property (@type.ShortName)</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@type.Id">@type.Resource (@type.ShortName)</option>
                                                            }
                                                        }
                                                    </select>

                                                    <div class="form-group row mt-3">
                                                        <div class="input-group flex-nowrap mb-3">
                                                            <div class="input-group flex-nowrap mb-3">
                                                                <span class="input-group-text" id="addon-wrapping">
                                                                    <span class="oi oi-magnifying-glass" id="addon-wrapping"></span>
                                                                </span>
                                                                <input class="form-control" type="search" placeholder="Filter by Name, Short Name"
                                                                       @bind="filterData"
                                                                       @bind:event="oninput">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    @if ((admin) && (Convert.ToBoolean(config.ResourceTypeEditingAllowed)))
                                                    {
                                                    <p>
                                                        <button type="button" class="modern-btn-success modern-btn-sm" @onclick="@(e => FormAction("ResourceType",0,"add"))" title="Add Resource Type">
                                                            <span class="oi oi-plus" aria-hidden="true"></span> Add Resource Type
                                                        </button>
                                                    </p>
                                                    }
                                                </p>
                                                <div class="modern-table-container">
                                                    <table class="modern-table">
                                                        <thead>
                                                            <tr>
                                                                <th>Name</th>
                                                                <th>Short Name</th>
                                                                @if (admin)
                                                                {
                                                                    <th>Optional</th>
                                                                    <th>Excluded</th>
                                                                    <th>Actions</th>
                                                                }
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (var item in @servicesData.ResourceTypes)
                                                            {
                                                                if (!IsTypeVisible(item))
                                                                    continue;
                                                                <tr class="@GeneralHelper.SetTextEnabledClass(item.Enabled)">
                                                                    @if (!String.IsNullOrEmpty(item.Property))
                                                                    {
                                                                        <td>@item.Resource - @item.Property<a id="@item.Id"></a></td>
                                                                    }
                                                                    else
                                                                    {
                                                                        <td>@item.Resource<a id="@item.Id"></a></td>
                                                                    }
                                                                    <td>@item.ShortName</td>
                                                                    @if (admin)
                                                                    {
                                                                        <td>
                                                                            @if (!String.IsNullOrEmpty(item.Optional))
                                                                            {
                                                                                @foreach (ResourceComponent component in @servicesData.ResourceComponents!.Where(y => y.Enabled).ToList())
                                                                                {
                                                                                    if (component.Name != "ResourceType")
                                                                                    {
                                                                                        @if (item.Optional.ToLower().Split(',').Contains(GeneralHelper.NormalizeName(component.Name, true)))
                                                                                        {
                                                                                            <div>@component.DisplayName</div>
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        </td>
                                                                        <td>
                                                                            @if (!String.IsNullOrEmpty(item.Exclude))
                                                                            {
                                                                                @foreach (ResourceComponent component in @servicesData.ResourceComponents!)
                                                                                {
                                                                                    //if (component.Name != "ResourceType")
                                                                                    //{
                                                                                    @if (item.Exclude.ToLower().Split(',').Contains(GeneralHelper.NormalizeName(component.Name, true)))
                                                                                    {
                                                                                        <div>@component.DisplayName</div>
                                                                                    }
                                                                                    //}
                                                                                }
                                                                            }
                                                                        </td>
                                                                        <td>
                                                                            <div class="modern-btn-group">
                                                                                <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => FormAction("ResourceType",item.Id,"edit"))" title="Edit">
                                                                                    <span class="oi oi-pencil" aria-hidden="true"></span>
                                                                                </button>
                                                                                @if (item.Enabled)
                                                                                {
                                                                                    <button type="button" class="modern-btn-dark modern-btn-sm" @onclick="@(e => FormAction("ResourceType",item.Id,"disable"))" title="Disable">
                                                                                        <span class="oi oi-ban" aria-hidden="true"></span>
                                                                                    </button>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <button type="button" class="modern-btn-success modern-btn-sm" @onclick="@(e => FormAction("ResourceType",item.Id,"enable"))" title="Enable">
                                                                                        <span class="oi oi-plus" aria-hidden="true"></span>
                                                                                    </button>
                                                                                }
                                                                                @if ((servicesData.ResourceTypes.Count > 1) && (Convert.ToBoolean(config.ResourceTypeEditingAllowed)))
                                                                                {
                                                                                    <button type="button" class="modern-btn-danger modern-btn-sm" @onclick="@(e => FormAction("ResourceType",item.Id,"delete"))" title="Delete">
                                                                                        <span class="oi oi-x" aria-hidden="true"></span>
                                                                                    </button>
                                                                                }
                                                                            </div>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        @if (admin)
                                        {
                                            <div class="modern-sub-card mb-2">
                                                <div class="modern-sub-card-header collapsible @(GetCollapseClass("typesconfig"))" @onclick="@(() => ToggleCollapse("typesconfig"))">
                                                    <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Configuration
                                                </div>
                                                <div class="modern-sub-card-body @(GetCollapseClass("typesconfig"))">
                                                    @if (!String.IsNullOrEmpty(resourceComponent.Description))
                                                    {
                                                        <p>@resourceComponent.Description</p>
                                                    }
                                                    <div class="modern-sub-card mb-2">
                                                        <div class="modern-sub-card-header">
                                                            Bulk Update
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Use the options below to bulk update all component options.
                                                            </p>
                                                            <p>
                                                                <button type="button" class="modern-btn-success modern-btn-sm" @onclick=@(e => FormAction(resourceComponent.Name,0,"uppercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-top" aria-hidden="true"></span> Convert to Uppercase
                                                                </button>
                                                                <button type="button" class="modern-btn-success modern-btn-sm" @onclick=@(e => FormAction(resourceComponent.Name,0,"lowercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-bottom" aria-hidden="true"></span> Convert to Lowercase
                                                                </button>
                                                            </p>
                                                        </div>
                                                    </div>
                                                    @if (ConfigurationHelper.VerifyConnectivity().Result)
                                                    {
                                                        <div class="modern-info-box mb-3">
                                                            <div class="modern-sub-card-header">
                                                                Refresh the Resource Types Configuration
                                                            </div>
                                                            <div class="modern-sub-card-body">
                                                                <p>
                                                                    Click <span class="fw-bold">Refresh</span> to download the latest Resource Types Configuration file from the Azure Naming Tool GitHub repository.
                                                                </p>
                                                                <p>
                                                                    <span class="fw-bold">NOTES:</span>
                                                                    <ul>
                                                                        <li>This will refresh the current Resource Types Configuration and cannot be undone!</li>
                                                                        <li>New resource type configurations will be added.</li>
                                                                        @if (refreshtypeshortnames)
                                                                        {
                                                                            <li>
                                                                                All resource type configurations will be updated, but all of the existing Resource Type Configurations (except the short name value) customizations will be retained.
                                                                            </li>
                                                                            <li>
                                                                                <span style="color:red; font-weight:bold;">Any customized short names will be overwritten.</span>
                                                                            </li>
                                                                        }
                                                                        else
                                                                        {
                                                                            <li>
                                                                                Resource type configurations will be updated, but all of the existing Resource Type Configurations customizations will be retained.
                                                                            </li>
                                                                        }
                                                                    </ul>
                                                                </p>
                                                                <p>
                                                                    <button type="button" class="modern-btn-success modern-btn-sm" @onclick=@(e => FormAction("ResourceType",0,"refresh")) title="Refresh">
                                                                        <span class="oi oi-reload" aria-hidden="true"></span> Refresh
                                                                    </button>
                                                                    <input title="Refresh Short Names" class="modern-form-check" type="checkbox" @onchange="@((ChangeEventArgs e) =>OnRefreshTypesCheckboxClicked(e))" style="margin-top: 9px; margin-left:10px;"> Refresh short names?
                                                                </p>
                                                            </div>
                                                        </div>
                                                    }
                                                    <div class="modern-warning-box mb-3">
                                                        <div class="modern-sub-card-header">
                                                            Reset the Resource Types Configuration
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Click <span class="fw-bold">Reset</span> to reset the Resource Types Configuration back to the default values at the time of installation.
                                                            </p>
                                                            <p>
                                                                <span class="fw-bold">NOTE:</span> This will reset the current Resource Types Configuration and cannot be undone!
                                                            </p>
                                                            <p>
                                                                <button type="button" class="modern-btn-danger modern-btn-sm" @onclick=@(e => FormAction("ResourceType",0,"reset")) title="Reset">
                                                                    <span class="oi oi-loop-circular" aria-hidden="true"></span> Reset
                                                                </button>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                            break;
                        case "ResourceUnitDept":
                            @if (GeneralHelper.IsNotNull(servicesData.ResourceUnitDepts))
                            {
                                <div class="modern-card mb-2" id="@resourceComponent.Name">
                                    <div class="modern-card-header collapsible @(GetCollapseClass("unitsdepts"))" @onclick="@(() => ToggleCollapse("unitsdepts"))">
                                        <h3 class="modern-card-title">
                                            <span class="oi oi-chevron-bottom" aria-hidden="true"></span> @resourceComponent.DisplayName
                                        </h3>
                                    </div>
                                    <div class="modern-card-body @(GetCollapseClass("unitsdepts"))">
                                        @if (!String.IsNullOrEmpty(resourceComponent.Description))
                                        {
                                            <p>@resourceComponent.Description</p>
                                        }
                                        <div class="modern-sub-card mb-2">
                                            <div class="modern-sub-card-header">
                                                Current Units/Depts
                                            </div>
                                            <div class="modern-sub-card-body">
                                                <p>The current Units/Depts.</p>
                                                @if (admin)
                                                {
                                                    <p>
                                                        <button type="button" class="modern-btn-success modern-btn-sm" @onclick="@(e => FormAction("ResourceUnitDept",0,"add"))" title="Add Unit/Dept">
                                                            <span class="oi oi-plus" aria-hidden="true"></span> Add Unit/Dept
                                                        </button>
                                                    </p>
                                                    <div class="drag-hint">
                                                        <span class="oi oi-move" aria-hidden="true"></span>
                                                        Drag and drop rows to reorder
                                                    </div>
                                                }
                                                <div class="modern-table-container">
                                                    <table class="modern-table">
                                                        <thead>
                                                            <tr>
                                                                @if (admin)
                                                                {
                                                                    <th style="width: 40px;"></th>
                                                                }
                                                                <th>Name</th>
                                                                <th>Short Name</th>
                                                                @if (admin)
                                                                {
                                                                    <th>Actions</th>
                                                                }
                                                            </tr>
                                                        </thead>
                                                        <tbody id="resourceUnitDeptsTableBody">
                                                            @foreach (var item in @servicesData.ResourceUnitDepts!.OrderBy(x => x.SortOrder))
                                                            {
                                                                <tr draggable="@(admin ? "true" : "false")"
                                                                    data-item-id="@item.Id">
                                                                    @if (admin)
                                                                    {
                                                                        <td style="width: 40px; text-align: center;">
                                                                            <span class="drag-handle oi oi-move" aria-hidden="true" title="Drag to reorder"></span>
                                                                        </td>
                                                                    }
                                                                    <td>@item.Name</td>
                                                                    <td>@item.ShortName</td>
                                                                    @if (admin)
                                                                    {
                                                                        <td>
                                                                            <div class="modern-btn-group">
                                                                                <button type="button" class="modern-btn-secondary modern-btn-sm" @onclick="@(e => FormAction("ResourceUnitDept",item.Id,"edit"))" title="Edit">
                                                                                    <span class="oi oi-pencil" aria-hidden="true"></span>
                                                                                </button>
                                                                                @if (servicesData.ResourceUnitDepts.Count > 1)
                                                                                {
                                                                                    <button type="button" class="modern-btn-danger modern-btn-sm" @onclick="@(e => FormAction("ResourceUnitDept",item.Id,"delete"))" title="Delete">
                                                                                        <span class="oi oi-x" aria-hidden="true"></span>
                                                                                    </button>
                                                                                }
                                                                            </div>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        @if (admin)
                                        {
                                            <div class="modern-sub-card mb-2">
                                                <div class="modern-sub-card-header collapsible @(GetCollapseClass("unitdeptsconfig"))" @onclick="@(() => ToggleCollapse("unitdeptsconfig"))">
                                                    <span class="oi oi-chevron-bottom" aria-hidden="true"></span> Configuration
                                                </div>
                                                <div class="modern-sub-card-body @(GetCollapseClass("unitdeptsconfig"))">
                                                    <div class="modern-sub-card mb-2">
                                                        <div class="modern-sub-card-header">
                                                            Bulk Update
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Use the options below to bulk update all component options.
                                                            </p>
                                                            <p>
                                                                <button type="button" class="modern-btn-success modern-btn-sm" @onclick=@(e => FormAction(resourceComponent.Name,0,"uppercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-top" aria-hidden="true"></span> Convert to Uppercase
                                                                </button>
                                                                <button type="button" class="modern-btn-success modern-btn-sm" @onclick=@(e => FormAction(resourceComponent.Name,0,"lowercase")) title="Uppercase">
                                                                    <span class="oi oi-arrow-thick-bottom" aria-hidden="true"></span> Convert to Lowercase
                                                                </button>
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="modern-warning-box mb-3">
                                                        <div class="modern-sub-card-header">
                                                            Reset the Units/Depts Configuration
                                                        </div>
                                                        <div class="modern-sub-card-body">
                                                            <p>
                                                                Click <span class="fw-bold">Reset</span> to reset the Units/Depts Configuration back to the default values at the time of installation.
                                                            </p>
                                                            <p>
                                                                <span class="fw-bold">NOTE:</span> This will reset the current Units/Depts configuration and cannot be undone!
                                                            </p>
                                                            <p>
                                                                <button type="button" class="modern-btn-danger modern-btn-sm" @onclick=@(e => FormAction("ResourceUnitDept",0,"reset")) title="Reset">
                                                                    <span class="oi oi-loop-circular" aria-hidden="true"></span> Reset
                                                                </button>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                            break;
                    }
                }
            </div>
        }
    </div>

@code {
    [Inject]
    public IBlazorDownloadFileService? BlazorDownloadFileService { get; set; }
    [Inject]
    public IResourceTypeService? ResourceTypeService { get; set; }
    [Inject]
    public IResourceComponentService? ResourceComponentService { get; set; }
    [Inject]
    public IResourceDelimiterService? ResourceDelimiterService { get; set; }
    [Inject]
    public IResourceEnvironmentService? ResourceEnvironmentService { get; set; }
    [Inject]
    public IResourceFunctionService? ResourceFunctionService { get; set; }
    [Inject]
    public IResourceLocationService? ResourceLocationService { get; set; }
    [Inject]
    public IResourceOrgService? ResourceOrgService { get; set; }
    [Inject]
    public IResourceProjAppSvcService? ResourceProjAppSvcService { get; set; }
    [Inject]
    public IResourceUnitDeptService? ResourceUnitDeptService { get; set; }
    [Inject]
    public ICustomComponentService? CustomComponentService { get; set; }
    [Inject]
    public IAdminLogService? AdminLogService { get; set; }
    [Inject]
    public IImportExportService? ImportExportService { get; set; }
    [Inject]
    public IPolicyService? PolicyService { get; set; }
    
    [CascadingParameter]
    public IModalService? Modal { get; set; }
    [CascadingParameter]
    protected ThemeInfo theme { get; set; } = new();

    private ServicesData servicesData = new();
    private int componentRenderKey = 0;
    private int environmentRenderKey = 0;
    private bool dataLoaded = false;
    private bool isLoading = false; // Prevent concurrent reload attempts
    private bool admin = false;
    private bool connectivityalertshown = false;
    private bool hasInternetConnectivity = true; // Assume true until checked
    private string versionalert = String.Empty;
    private bool versionalertshown = false;
    private bool dismissalert = false;
    private bool configurationfilealertshown = false;
    private string appversion = ConfigurationHelper.GetAssemblyVersion();

    public string filterData { get; set; } = String.Empty;

    private string[] protectedComponents = new string[] { "resourcetype", "resourcedelimiter" };
    private List<string> categories = new();
    private string selectedResourceTypeCategory = String.Empty;
    private string newComponentConfig = String.Empty;
    private string newDelimiterConfig = String.Empty;
    private string newEnvironmentName = String.Empty;
    private string newEnvironmentShortName = String.Empty;
    private string newEnvironmentConfig = String.Empty;
    private string newLocationName = String.Empty;
    private string newLocationShortName = String.Empty;
    private string newLocationConfig = String.Empty;
    private string newOrgName = String.Empty;
    private string newOrgShortName = String.Empty;
    private string newOrgConfig = String.Empty;
    private string newProjAppSvcName = String.Empty;
    private string newProjAppSvcShortName = String.Empty;
    private string newProjAppSvcConfig = String.Empty;
    private string newTypeConfig = String.Empty;
    private string newUnitDeptName = String.Empty;
    private string newUnitDeptShortName = String.Empty;
    private string newUnitDeptConfig = String.Empty;
    private string newFunctionName = String.Empty;
    private string newFunctionShortName = String.Empty;
    private string newFunctionConfig = String.Empty;
    private string newCustomComponentConfig = String.Empty;
    private string newGlobalConfig = String.Empty;
    private bool refreshtypeshortnames = false;
    private bool refreshlocationshortnames = false;
    private bool includeAdmin = false;
    private string currentuser = String.Empty;
    
    // Storage provider detection for UI adaptation
    private string currentStorageProvider = "FileSystem";
    private bool isUsingSQLite => currentStorageProvider == "SQLite";
    private bool isUsingFileSystem => currentStorageProvider == "FileSystem";
    
    // File upload handlers for restore functionality
    private IBrowserFile? sqliteBackupFile;
    private IBrowserFile? jsonBackupFile;

    // Collapse state tracking - all sections collapsed by default
    private HashSet<string> collapsedSections = new HashSet<string>
    {
        "components",
        "componentsconfig",
        "delimiters",
        "delimitersconfig",
        "customcomponents",
        "customcomponentconfig",
        "environments",
        "environmentsconfig",
        "functions",
        "functionsconfig",
        "locations",
        "locationsconfig",
        "orgs",
        "orgsconfig",
        "projsappssvcs",
        "projappsvcsconfig",
        "types",
        "typesconfig",
        "unitsdepts",
        "unitdeptsconfig"
    };

    private void ToggleCollapse(string sectionId)
    {
        if (collapsedSections.Contains(sectionId))
        {
            collapsedSections.Remove(sectionId);
        }
        else
        {
            collapsedSections.Add(sectionId);
        }
    }

    private string GetCollapseClass(string sectionId)
    {
        return collapsedSections.Contains(sectionId) ? "collapsed" : "";
    }

    private void ExpandAll()
    {
        collapsedSections.Clear();
    }

    private void CollapseAll()
    {
        // Add all section IDs to the collapsed set
        collapsedSections = new HashSet<string>
        {
            "components",
            "componentsconfig",
            "delimiters",
            "delimitersconfig",
            "customcomponents",
            "customcomponentconfig",
            "environments",
            "environmentsconfig",
            "functions",
            "functionsconfig",
            "locations",
            "locationsconfig",
            "orgs",
            "orgsconfig",
            "projsappssvcs",
            "projappsvcsconfig",
            "types",
            "typesconfig",
            "unitsdepts",
            "unitdeptsconfig"
        };
        
        // Add dynamic custom component sections
        if (servicesData?.CustomComponents != null)
        {
            foreach (var customComponent in servicesData.CustomComponents)
            {
                collapsedSections.Add($"custom{customComponent.Id}");
            }
        }
    }

    private ResponseMessage message = new();

    private SiteConfiguration config = ConfigurationHelper.GetConfigurationData();

    protected override Task OnInitializedAsync()
    {
        // Always ensure we're starting fresh
        dataLoaded = false;
        isLoading = false;
        return Task.CompletedTask;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        // Skip if already loading to prevent concurrent initialization
        if (isLoading) return;
        
        try
        {
            currentuser = await IdentityHelper.GetCurrentUser(session);
            
            // Check if cache was cleared - if so, force reload
            var forceReload = await session.GetAsync<bool>("forceconfigreload");
            if (forceReload.Success && forceReload.Value)
            {
                dataLoaded = false;
                await session.DeleteAsync("forceconfigreload");
            }
            
            // Do full initialization if not yet done (first load OR after cache clear)
            if (!dataLoaded)
            {
                isLoading = true;
                
                try
                {
                    var result = await session.GetAsync<bool>("admin");
                    admin = (bool)result.Value;
                    await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                
                    // Detect current storage provider for UI adaptation
                    currentStorageProvider = ConfigurationHelper.GetAppSetting("StorageProvider") ?? "FileSystem";

                    // Get the list of categories
                    categories = ResourceTypeService!.GetTypeCategories(servicesData.ResourceTypes!);
            
                    // Initialize collapsed state for custom components
                    if (servicesData?.CustomComponents != null)
                    {
                        foreach (var customComponent in servicesData.CustomComponents)
                        {
                            collapsedSections.Add($"custom{customComponent.Id}");
                        }
                    }
                }
                finally
                {
                    // ALWAYS set these flags even if an exception occurred
                    dataLoaded = true;
                    isLoading = false;
                    // Don't call StateHasChanged here - it hangs on Azure after cache clear
                    // The UI will update after the finally block completes
                }
                    
                    // Check internet connectivity asynchronously
                    hasInternetConnectivity = await ConfigurationHelper.VerifyConnectivity();
                    
                    // Determine if the connectivity notification has been dismissed
                    var resultConnectivityAlertShown = await session.GetAsync<bool>("connectivityalertshown");
                    connectivityalertshown = resultConnectivityAlertShown.Success ? resultConnectivityAlertShown.Value : false;

                    // Configuration File Check
                    // Determine if the installed version of the configuration files are up to date
                    if (admin)
                    {

                        // Determine if the version notification has been dismissed
                        var resultVersionAlert = await session.GetAsync<bool>("versionalert-" + appversion + "-shown");
                        versionalertshown = resultVersionAlert.Success ? resultVersionAlert.Value : false;
                        if (!versionalertshown)
                        {
                            versionalert = ConfigurationHelper.GetVersionAlert().Result;
                            if (String.IsNullOrEmpty(versionalert))
                            {
                                versionalertshown = true;
                                await session.SetAsync("versionalert-" + appversion + "-shown", true);
                            }
                        }

                        var resultConfigurationFileAlert = await session.GetAsync<bool>("configurationfilealertshown");
                        configurationfilealertshown = resultConfigurationFileAlert.Success ? resultConfigurationFileAlert.Value : false;

                        // Check connectivity
                        if (await ConfigurationHelper.VerifyConnectivity())
                        {
                            if (!configurationfilealertshown)
                            {
                                // Get a list of any configurations that are out of date
                                List<string> versiondata = await ConfigurationHelper.VerifyConfigurationFileVersionData();
                                if (versiondata.Count > 0)
                                {
                                    string versionmessage = "";
                                    foreach (string message in versiondata)
                                    {
                                        versionmessage += message;
                                    }
                                    // Display a notification of the files requiring updating
                                    ModalHelper.ShowInformationModal(Modal!, theme, "bg-navcolor", "ATTENTION", versionmessage, "", admin);
                                    await session.SetAsync("configurationfilealertshown", true);
                                }
                            }
                        }
                    }
                    StateHasChanged();
            
                    // Initialize drag-and-drop for all sortable sections if admin (only on first render)
                    if (admin && dataLoaded)
                    {
                        // Register this component instance with JavaScript for callbacks
                        var dotNetReference = DotNetObjectReference.Create(this);
                        await JsRuntime.InvokeVoidAsync("registerConfigurationPage", dotNetReference);
                
                        // Initialize Resource Components
                        await JsRuntime.InvokeVoidAsync("dragDropSort.init", 
                            "resourceComponentsTableBody");

                        // Initialize Custom Components (one for each custom component)
                        if (servicesData?.ResourceComponents != null)
                        {
                            foreach (var resourceComponent in servicesData.ResourceComponents.Where(x => x.IsCustom))
                            {
                                var customComponentId = resourceComponent.Id;
                                var containerId = $"customComponent{customComponentId}TableBody";
                                await JsRuntime.InvokeVoidAsync("dragDropSort.init", containerId);
                            }
                        }

                        // Initialize Environments
                        await JsRuntime.InvokeVoidAsync("dragDropSort.init", "resourceEnvironmentsTableBody");

                        // Initialize Functions
                        await JsRuntime.InvokeVoidAsync("dragDropSort.init", "resourceFunctionsTableBody");

                        // Initialize Orgs
                        await JsRuntime.InvokeVoidAsync("dragDropSort.init", "resourceOrgsTableBody");

                        // Initialize Projects/Apps/Services
                        await JsRuntime.InvokeVoidAsync("dragDropSort.init", "resourceProjAppSvcsTableBody");

                        // Initialize Units/Depts
                        await JsRuntime.InvokeVoidAsync("dragDropSort.init", "resourceUnitDeptsTableBody");
                    }
                    
                    StateHasChanged(); // Final render update
            }
        }
        catch (Exception ex)
        {
            await AdminLogService.PostItemAsync(new AdminLogMessage() { Title = "ERROR", Message = $"Configuration page load error: {ex.Message}" });
            dataLoaded = true; // Set to true to show error instead of infinite loading
            StateHasChanged();
        }
    }

    public void Dispose()
    {
        StateHasChanged();
    }

    /// <summary>
    /// Handles reordering of Resource Components after drag-and-drop
    /// </summary>
    [JSInvokable]
    public async Task HandleResourceComponentReorder()
    {
        try
        {
            // Get the current order from the DOM
            var reorderData = await JsRuntime.InvokeAsync<List<ReorderItem>>("dragDropSort.getReorderData", "resourceComponentsTableBody");
            
            if (reorderData == null || reorderData.Count == 0)
            {
                return;
            }

            // Update sort orders in memory
            foreach (var reorderItem in reorderData)
            {
                var resourceComponent = servicesData.ResourceComponents!.Find(x => x.Id == reorderItem.ItemId);
                if (resourceComponent != null)
                {
                    resourceComponent.SortOrder = reorderItem.SortOrder;
                }
            }

            // Re-sort the list in memory to match the new sort orders
            servicesData.ResourceComponents = servicesData.ResourceComponents!
                .OrderBy(x => x.SortOrder)
                .ToList();

            // Save all at once with UpdateSortOrderAsync
            var serviceResponse = await ResourceComponentService!.UpdateSortOrderAsync(servicesData.ResourceComponents!);

            // Don't call StateHasChanged() - let JavaScript's DOM changes stay
            // The data is saved, and will be correct on next page load
            
            if (serviceResponse.Success)
            {
                toastService.ShowSuccess("Component order updated successfully!");
            }
            else
            {
                toastService.ShowError("Failed to update component order. Please check the Admin Log.");
            }

            // Don't call StateHasChanged() here
        }
        catch (Exception ex)
        {
            await AdminLogService!.PostItemAsync(new AdminLogMessage 
            { 
                Title = "ERROR", 
                Message = $"Error reordering components: {ex.Message}" 
            });
            toastService.ShowError("Failed to update component order. Please check the Admin Log.");
        }
    }

    /// <summary>
    /// Handles reordering of custom components for a specific parent component
    /// </summary>
    [JSInvokable]
    public async Task HandleCustomComponentReorder(long parentComponentId)
    {
        try
        {
            var containerId = $"customComponent{parentComponentId}TableBody";
            var reorderData = await JsRuntime.InvokeAsync<List<ReorderItem>>("dragDropSort.getReorderData", containerId);
            
            if (reorderData == null || reorderData.Count == 0)
            {
                return;
            }

            // Update sort orders in memory
            foreach (var reorderItem in reorderData)
            {
                var customComponent = servicesData.CustomComponents!.Find(x => x.Id == reorderItem.ItemId);
                if (customComponent != null)
                {
                    customComponent.SortOrder = reorderItem.SortOrder;
                }
            }

            // Re-sort the list in memory to match the new sort orders
            servicesData.CustomComponents = servicesData.CustomComponents!
                .OrderBy(x => x.SortOrder)
                .ToList();

            // Save all at once with UpdateSortOrderAsync
            var serviceResponse = await CustomComponentService!.UpdateSortOrderAsync(servicesData.CustomComponents!);

            // Don't call StateHasChanged() - let JavaScript's DOM changes stay
            // The data is saved, and will be correct on next page load
            
            if (serviceResponse.Success)
            {
                toastService.ShowSuccess("Custom component order updated successfully!");
            }
            else
            {
                toastService.ShowError("Failed to update custom component order. Please check the Admin Log.");
            }

            // Don't call StateHasChanged() here
        }
        catch (Exception ex)
        {
            await AdminLogService!.PostItemAsync(new AdminLogMessage 
            { 
                Title = "ERROR", 
                Message = $"Error reordering custom components: {ex.Message}" 
            });
            toastService.ShowError("Failed to update custom component order. Please check the Admin Log.");
        }
    }

    /// <summary>
    /// Handles reordering of environments
    /// </summary>
    [JSInvokable]
    public async Task HandleEnvironmentReorder()
    {
        try
        {
            var reorderData = await JsRuntime.InvokeAsync<List<ReorderItem>>("dragDropSort.getReorderData", "resourceEnvironmentsTableBody");
            
            if (reorderData == null || reorderData.Count == 0)
            {
                return;
            }

            // Update sort orders in memory
            foreach (var reorderItem in reorderData)
            {
                var environment = servicesData.ResourceEnvironments!.Find(x => x.Id == reorderItem.ItemId);
                if (environment != null)
                {
                    environment.SortOrder = reorderItem.SortOrder;
                }
            }

            // Re-sort the list in memory to match the new sort orders
            servicesData.ResourceEnvironments = servicesData.ResourceEnvironments!
                .OrderBy(x => x.SortOrder)
                .ToList();

            // Save all at once with UpdateSortOrderAsync
            var serviceResponse = await ResourceEnvironmentService!.UpdateSortOrderAsync(servicesData.ResourceEnvironments!);

            // Don't call StateHasChanged() - let JavaScript's DOM changes stay
            // The data is saved, and will be correct on next page load
            
            if (serviceResponse.Success)
            {
                toastService.ShowSuccess("Environment order updated successfully!");
            }
            else
            {
                toastService.ShowError("Failed to update environment order. Please check the Admin Log.");
            }

            // Don't call StateHasChanged() here
        }
        catch (Exception ex)
        {
            await AdminLogService!.PostItemAsync(new AdminLogMessage 
            { 
                Title = "ERROR", 
                Message = $"Error reordering environments: {ex.Message}" 
            });
            toastService.ShowError("Failed to update environment order. Please check the Admin Log.");
        }
    }

    /// <summary>
    /// Handles reordering of functions
    /// </summary>
    [JSInvokable]
    public async Task HandleFunctionReorder()
    {
        try
        {
            var reorderData = await JsRuntime.InvokeAsync<List<ReorderItem>>("dragDropSort.getReorderData", "resourceFunctionsTableBody");
            
            if (reorderData == null || reorderData.Count == 0)
            {
                return;
            }

            // Update sort orders in memory
            foreach (var reorderItem in reorderData)
            {
                var function = servicesData.ResourceFunctions!.Find(x => x.Id == reorderItem.ItemId);
                if (function != null)
                {
                    function.SortOrder = reorderItem.SortOrder;
                }
            }

            // Re-sort the list in memory to match the new sort orders
            servicesData.ResourceFunctions = servicesData.ResourceFunctions!
                .OrderBy(x => x.SortOrder)
                .ToList();

            // Save all at once with UpdateSortOrderAsync
            var serviceResponse = await ResourceFunctionService!.UpdateSortOrderAsync(servicesData.ResourceFunctions!);

            // Don't call StateHasChanged() - let JavaScript's DOM changes stay
            // The data is saved, and will be correct on next page load
            
            if (serviceResponse.Success)
            {
                toastService.ShowSuccess("Function order updated successfully!");
            }
            else
            {
                toastService.ShowError("Failed to update function order. Please check the Admin Log.");
            }

            // Don't call StateHasChanged() here
        }
        catch (Exception ex)
        {
            await AdminLogService!.PostItemAsync(new AdminLogMessage 
            { 
                Title = "ERROR", 
                Message = $"Error reordering functions: {ex.Message}" 
            });
            toastService.ShowError("Failed to update function order. Please check the Admin Log.");
        }
    }

    /// <summary>
    /// Handles reordering of orgs
    /// </summary>
    [JSInvokable]
    public async Task HandleOrgReorder()
    {
        try
        {
            var reorderData = await JsRuntime.InvokeAsync<List<ReorderItem>>("dragDropSort.getReorderData", "resourceOrgsTableBody");
            
            if (reorderData == null || reorderData.Count == 0)
            {
                return;
            }

            // Update sort orders in memory
            foreach (var reorderItem in reorderData)
            {
                var org = servicesData.ResourceOrgs!.Find(x => x.Id == reorderItem.ItemId);
                if (org != null)
                {
                    org.SortOrder = reorderItem.SortOrder;
                }
            }

            // Re-sort the list in memory to match the new sort orders
            servicesData.ResourceOrgs = servicesData.ResourceOrgs!
                .OrderBy(x => x.SortOrder)
                .ToList();

            // Save all at once with UpdateSortOrderAsync
            var serviceResponse = await ResourceOrgService!.UpdateSortOrderAsync(servicesData.ResourceOrgs!);

            // Don't call StateHasChanged() - let JavaScript's DOM changes stay
            // The data is saved, and will be correct on next page load
            
            if (serviceResponse.Success)
            {
                toastService.ShowSuccess("Org order updated successfully!");
            }
            else
            {
                toastService.ShowError("Failed to update org order. Please check the Admin Log.");
            }

            // Don't call StateHasChanged() here
        }
        catch (Exception ex)
        {
            await AdminLogService!.PostItemAsync(new AdminLogMessage 
            { 
                Title = "ERROR", 
                Message = $"Error reordering orgs: {ex.Message}" 
            });
            toastService.ShowError("Failed to update org order. Please check the Admin Log.");
        }
    }

    /// <summary>
    /// Handles reordering of projects/apps/services
    /// </summary>
    [JSInvokable]
    public async Task HandleProjAppSvcReorder()
    {
        try
        {
            var reorderData = await JsRuntime.InvokeAsync<List<ReorderItem>>("dragDropSort.getReorderData", "resourceProjAppSvcsTableBody");
            
            if (reorderData == null || reorderData.Count == 0)
            {
                return;
            }

            // Update sort orders in memory
            foreach (var reorderItem in reorderData)
            {
                var projAppSvc = servicesData.ResourceProjAppSvcs!.Find(x => x.Id == reorderItem.ItemId);
                if (projAppSvc != null)
                {
                    projAppSvc.SortOrder = reorderItem.SortOrder;
                }
            }

            // Re-sort the list in memory to match the new sort orders
            servicesData.ResourceProjAppSvcs = servicesData.ResourceProjAppSvcs!
                .OrderBy(x => x.SortOrder)
                .ToList();

            // Save all at once with UpdateSortOrderAsync
            var serviceResponse = await ResourceProjAppSvcService!.UpdateSortOrderAsync(servicesData.ResourceProjAppSvcs!);

            // Don't call StateHasChanged() - let JavaScript's DOM changes stay
            // The data is saved, and will be correct on next page load
            
            if (serviceResponse.Success)
            {
                toastService.ShowSuccess("Project/App/Service order updated successfully!");
            }
            else
            {
                toastService.ShowError("Failed to update project/app/service order. Please check the Admin Log.");
            }

            // Don't call StateHasChanged() here
        }
        catch (Exception ex)
        {
            await AdminLogService!.PostItemAsync(new AdminLogMessage 
            { 
                Title = "ERROR", 
                Message = $"Error reordering projects/apps/services: {ex.Message}" 
            });
            toastService.ShowError("Failed to update project/app/service order. Please check the Admin Log.");
        }
    }

    /// <summary>
    /// Handles reordering of units/depts
    /// </summary>
    [JSInvokable]
    public async Task HandleUnitDeptReorder()
    {
        try
        {
            var reorderData = await JsRuntime.InvokeAsync<List<ReorderItem>>("dragDropSort.getReorderData", "resourceUnitDeptsTableBody");
            
            if (reorderData == null || reorderData.Count == 0)
            {
                return;
            }

            // Update sort orders in memory
            foreach (var reorderItem in reorderData)
            {
                var unitDept = servicesData.ResourceUnitDepts!.Find(x => x.Id == reorderItem.ItemId);
                if (unitDept != null)
                {
                    unitDept.SortOrder = reorderItem.SortOrder;
                }
            }

            // Re-sort the list in memory to match the new sort orders
            servicesData.ResourceUnitDepts = servicesData.ResourceUnitDepts!
                .OrderBy(x => x.SortOrder)
                .ToList();

            // Save all at once with UpdateSortOrderAsync
            var serviceResponse = await ResourceUnitDeptService!.UpdateSortOrderAsync(servicesData.ResourceUnitDepts!);

            // Don't call StateHasChanged() - let JavaScript's DOM changes stay
            // The data is saved, and will be correct on next page load
            
            if (serviceResponse.Success)
            {
                toastService.ShowSuccess("Unit/Dept order updated successfully!");
            }
            else
            {
                toastService.ShowError("Failed to update unit/dept order. Please check the Admin Log.");
            }

            // Don't call StateHasChanged() here
        }
        catch (Exception ex)
        {
            await AdminLogService!.PostItemAsync(new AdminLogMessage 
            { 
                Title = "ERROR", 
                Message = $"Error reordering units/depts: {ex.Message}" 
            });
            toastService.ShowError("Failed to update unit/dept order. Please check the Admin Log.");
        }
    }

    // Helper class for reorder data
    public class ReorderItem
    {
        public long ItemId { get; set; }
        public int SortOrder { get; set; }
    }

    public bool IsTypeVisible(ResourceType type)
    {
        bool visible = true;

        if (!string.IsNullOrEmpty(filterData))
        {
            if ((!type.Resource.Contains(filterData, StringComparison.OrdinalIgnoreCase)) && (!type.ShortName.Contains(filterData, StringComparison.OrdinalIgnoreCase)))
                visible = false;
        }
        return visible;
    }

    private async Task FormAction(string type, long id, string action, string parentcomponent = "")
    {
        if (GeneralHelper.IsNotNull(servicesData))
        {
            message = new ResponseMessage();
            bool confirm = false;
            bool generalerror = false;
            bool response = false;
            var workingmodaloptions = new ModalOptions()
                {
                    HideCloseButton = true,
                    UseCustomLayout = true
                };
            if (GeneralHelper.IsNotNull(Modal))
            {
                var workingmodal = Modal.Show<WorkingModal>("Working", workingmodaloptions);
                try
                {
                    ServiceResponse serviceResponse = new();
                    JsonSerializerOptions options = new JsonSerializerOptions
                        {
                            PropertyNameCaseInsensitive = true
                        };

                    // Get the matching resource component for the item being configured
                    ResourceComponent thisresourceComponent = new();
                    if (type != "ResourceComponent")
                    {
                        // Check if it's a custom component
                        if (type == "CustomComponent")
                        {
                            if (!String.IsNullOrEmpty(parentcomponent))
                            {
                                thisresourceComponent = servicesData.ResourceComponents!.Find(x => GeneralHelper.NormalizeName(x.Name, true) == GeneralHelper.NormalizeName(parentcomponent, true))!;
                            }
                        }
                        else
                        {
                            thisresourceComponent = servicesData.ResourceComponents!.Find(x => x.Name == type)!;
                        }
                    }
                    switch (type)
                    {
                        case "ResourceComponent":
                            ResourceComponent resourceComponent = new();
                            switch (action)
                            {
                                case "up":
                                    resourceComponent = servicesData.ResourceComponents!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceComponent))
                                    {
                                        // Get the component in the list
                                        if (resourceComponent.SortOrder > 1)
                                        {
                                            resourceComponent.SortOrder += -1;
                                        }
                                        serviceResponse = await ResourceComponentService!.PostItemAsync(resourceComponent);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceComponent.Name + " moved up!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceComponent.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "down":
                                    resourceComponent = servicesData.ResourceComponents!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceComponent))
                                    {
                                        if (resourceComponent.SortOrder <= servicesData.ResourceComponents.Count)
                                        {
                                            resourceComponent.SortOrder += 1;
                                        }
                                        serviceResponse = await ResourceComponentService!.PostItemAsync(resourceComponent);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceComponent.Name + " moved down!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceComponent.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "enable":
                                    resourceComponent = servicesData.ResourceComponents!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceComponent))
                                    {
                                        resourceComponent.Enabled = true;
                                        
                                        // Reorganize all items: enabled first (ordered by current sort), then disabled
                                        var enabledItems = servicesData.ResourceComponents
                                            .Where(x => x.Enabled && x.Id != resourceComponent.Id)
                                            .OrderBy(x => x.SortOrder)
                                            .ToList();
                                        
                                        var disabledItems = servicesData.ResourceComponents
                                            .Where(x => !x.Enabled && x.Id != resourceComponent.Id)
                                            .OrderBy(x => x.SortOrder)
                                            .ToList();
                                        
                                        // Add the newly enabled item at the end of enabled items
                                        enabledItems.Add(resourceComponent);
                                        
                                        // Reassign sort orders
                                        int sortOrder = 1;
                                        foreach (var item in enabledItems)
                                        {
                                            item.SortOrder = sortOrder++;
                                        }
                                        foreach (var item in disabledItems)
                                        {
                                            item.SortOrder = sortOrder++;
                                        }
                                        
                                        // Save all items with updated sort orders
                                        await ResourceComponentService!.UpdateSortOrderAsync(servicesData.ResourceComponents);
                                        
                                        message.Type = MessageTypesEnum.SUCCESS;
                                        message.Message = resourceComponent.Name + " enabled!";
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "disable":
                                    resourceComponent = servicesData.ResourceComponents!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceComponent))
                                    {
                                        resourceComponent.Enabled = false;
                                        
                                        // Reorganize all items: enabled first (ordered by current sort), then disabled
                                        var enabledItems = servicesData.ResourceComponents
                                            .Where(x => x.Enabled && x.Id != resourceComponent.Id)
                                            .OrderBy(x => x.SortOrder)
                                            .ToList();
                                        
                                        var disabledItems = servicesData.ResourceComponents
                                            .Where(x => !x.Enabled && x.Id != resourceComponent.Id)
                                            .OrderBy(x => x.SortOrder)
                                            .ToList();
                                        
                                        // Add the newly disabled item at the end of disabled items
                                        disabledItems.Add(resourceComponent);
                                        
                                        // Reassign sort orders
                                        int sortOrder = 1;
                                        foreach (var item in enabledItems)
                                        {
                                            item.SortOrder = sortOrder++;
                                        }
                                        foreach (var item in disabledItems)
                                        {
                                            item.SortOrder = sortOrder++;
                                        }
                                        
                                        // Save all items with updated sort orders
                                        await ResourceComponentService!.UpdateSortOrderAsync(servicesData.ResourceComponents);
                                        
                                        message.Type = MessageTypesEnum.SUCCESS;
                                        message.Message = resourceComponent.Name + " disabled!";
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "blank":
                                    break;
                                case "add":
                                    confirm = await ModalHelper.ShowAddModal(Modal!, servicesData, theme, "bg-navcolor", "Add Component", "<p>Add a Component.</p>", (int)id, "ResourceComponent", admin, "");
                                    if (confirm)
                                    {
                                        await ReloadSpecificData("ResourceComponent");
                                        state.SetNavReload(true);
                                    }
                                    break;
                                case "edit":
                                    resourceComponent = servicesData.ResourceComponents!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceComponent))
                                    {
                                        confirm = await ModalHelper.ShowEditModal(Modal, servicesData, theme, "bg-navcolor", "Edit Component", "Edit the Component.", (int)id, "ResourceComponent", !resourceComponent.IsCustom);
                                        if (confirm)
                                        {
                                            await ReloadSpecificData("ResourceComponent");
                                            state.SetNavReload(true);
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "delete":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will delete the Component and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        resourceComponent = servicesData.ResourceComponents!.Find(x => x.Id == id)!;
                                        if (GeneralHelper.IsNotNull(resourceComponent))
                                        {
                                            serviceResponse = await ResourceComponentService!.DeleteItemAsync(Convert.ToInt32(resourceComponent.Id));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = resourceComponent.Name + " deleted!";
                                                state.SetNavReload(true);
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = resourceComponent.Name + " deletion failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                        else
                                        {
                                            generalerror = true;
                                        }
                                    }
                                    break;
                                case "download":
                                    serviceResponse = await ResourceComponentService!.GetItemsAsync(true);
                                    if (serviceResponse.Success)
                                    {
                                        if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                        {
                                            var componentjson = serviceResponse.ResponseObject!;
                                            if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                            {
                                                await BlazorDownloadFileService.DownloadFileFromText("componentsconfig.json", JsonSerializer.Serialize(componentjson).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                            }
                                        }
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Components Configuration to the default repository values and cannot be undone!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        var resetResult = await ResetConfigurationData<ResourceComponent>("resourcecomponents.json", ResourceComponentService!.PostConfigAsync);
                                        if (resetResult.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Components configuration reset! Page will refresh in 2 seconds...";
                                            
                                            // Force page refresh to show updated data
                                            await Task.Delay(2000);
                                            NavigationManager!.NavigateTo("/configuration", true);
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resetResult.Message;
                                            message.MessageDetails = resetResult.Details ?? string.Empty;
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newTypeConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Components Configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            serviceResponse = await ResourceComponentService!.PostConfigAsync(JsonSerializer.Deserialize<List<ResourceComponent>>(newTypeConfig, options)!);
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Resource Components config update succeeded!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Resource Components config update failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                    }

                                    break;
                            }
                            serviceResponse = await ResourceComponentService!.GetItemsAsync(admin);
                            if (serviceResponse.Success)
                            {
                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                {
                                    servicesData.ResourceComponents = (List<ResourceComponent>)serviceResponse.ResponseObject!;
                                }
                            }
                            break;
                        case "ResourceDelimiter":
                            ResourceDelimiter resourceDelimiter = new();
                            switch (action)
                            {
                                case "enable":
                                    resourceDelimiter = servicesData.ResourceDelimiters!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceDelimiter))
                                    {
                                        // First, disable ALL delimiters
                                        foreach (var item in servicesData.ResourceDelimiters)
                                        {
                                            item.Enabled = false;
                                        }
                                        
                                        // Then enable only the selected one
                                        resourceDelimiter.Enabled = true;
                                        
                                        // Reorganize all items: enabled first (ordered by current sort), then disabled
                                        var enabledItems = servicesData.ResourceDelimiters
                                            .Where(x => x.Enabled)
                                            .OrderBy(x => x.SortOrder)
                                            .ToList();
                                        
                                        var disabledItems = servicesData.ResourceDelimiters
                                            .Where(x => !x.Enabled)
                                            .OrderBy(x => x.SortOrder)
                                            .ToList();
                                        
                                        // Reassign sort orders
                                        int sortOrder = 1;
                                        foreach (var item in enabledItems)
                                        {
                                            item.SortOrder = sortOrder++;
                                        }
                                        foreach (var item in disabledItems)
                                        {
                                            item.SortOrder = sortOrder++;
                                        }
                                        
                                        // Save all items with updated sort orders
                                        serviceResponse = await ResourceDelimiterService!.PostConfigAsync(servicesData.ResourceDelimiters);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceDelimiter.Name + " enabled!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceDelimiter.Name + " enabling failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "disable":
                                    resourceDelimiter = servicesData.ResourceDelimiters!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceDelimiter))
                                    {
                                        resourceDelimiter.Enabled = false;
                                        
                                        // Reorganize all items: enabled first (ordered by current sort), then disabled
                                        var enabledItems = servicesData.ResourceDelimiters
                                            .Where(x => x.Enabled && x.Id != resourceDelimiter.Id)
                                            .OrderBy(x => x.SortOrder)
                                            .ToList();
                                        
                                        var disabledItems = servicesData.ResourceDelimiters
                                            .Where(x => !x.Enabled && x.Id != resourceDelimiter.Id)
                                            .OrderBy(x => x.SortOrder)
                                            .ToList();
                                        
                                        // Add the newly disabled item at the end of disabled items
                                        disabledItems.Add(resourceDelimiter);
                                        
                                        // Reassign sort orders
                                        int sortOrder = 1;
                                        foreach (var item in enabledItems)
                                        {
                                            item.SortOrder = sortOrder++;
                                        }
                                        foreach (var item in disabledItems)
                                        {
                                            item.SortOrder = sortOrder++;
                                        }
                                        
                                        // Save all items with updated sort orders
                                        serviceResponse = await ResourceDelimiterService!.PostConfigAsync(servicesData.ResourceDelimiters);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceDelimiter.Name + " disabled!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceDelimiter.Name + " disabling failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "download":
                                    serviceResponse = await ResourceDelimiterService!.GetItemsAsync(admin);
                                    if (serviceResponse.Success)
                                    {
                                        if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                        {
                                            var delimiterjson = serviceResponse.ResponseObject!;
                                            if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                            {
                                                await BlazorDownloadFileService.DownloadFileFromText("delimitersconfig.json", JsonSerializer.Serialize(delimiterjson).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                            }
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newDelimiterConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Delimiters Configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            serviceResponse = await ResourceDelimiterService!.PostConfigAsync(JsonSerializer.Deserialize<List<ResourceDelimiter>>(newDelimiterConfig, options)!);
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Resource Delimiters config update succeeded!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Resource Delimiters config update failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Delimiters Configuration to the default repository values and cannot be undone!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        var resetResult = await ResetConfigurationData<ResourceDelimiter>("resourcedelimiters.json", ResourceDelimiterService!.PostConfigAsync);
                                        if (resetResult.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Delimiters configuration reset! Page will refresh in 2 seconds...";
                                            
                                            // Force page refresh to show updated data
                                            await Task.Delay(2000);
                                            NavigationManager!.NavigateTo("/configuration", true);
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resetResult.Message;
                                            message.MessageDetails = resetResult.Details ?? string.Empty;
                                        }
                                    }
                                    break;
                            }
                            serviceResponse = await ResourceDelimiterService!.GetItemsAsync(admin);
                            if (serviceResponse.Success)
                            {
                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                {
                                    servicesData.ResourceDelimiters = (List<ResourceDelimiter>)serviceResponse.ResponseObject!;
                                }
                            }
                            break;
                        case "ResourceEnvironment":
                            ResourceEnvironment resourceEnvironment;
                            switch (action)
                            {
                                case "up":
                                    // Get the component in the list
                                    resourceEnvironment = servicesData.ResourceEnvironments!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceEnvironment))
                                    {
                                        if (resourceEnvironment.SortOrder > 1)
                                        {
                                            resourceEnvironment.SortOrder += -1;
                                        }
                                        serviceResponse = await ResourceEnvironmentService!.PostItemAsync(resourceEnvironment);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceEnvironment.Name + " moved up!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceEnvironment.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "down":
                                    resourceEnvironment = servicesData.ResourceEnvironments!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceEnvironment))
                                    {
                                        if (resourceEnvironment.SortOrder <= servicesData.ResourceEnvironments.Count)
                                        {
                                            resourceEnvironment.SortOrder += 1;
                                        }
                                        serviceResponse = await ResourceEnvironmentService!.PostItemAsync(resourceEnvironment);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceEnvironment.Name + " moved down!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceEnvironment.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "edit":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        confirm = await ModalHelper.ShowEditModal(Modal, servicesData, theme, "bg-navcolor", "Edit Environment", "<p>Edit the Environment.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li></ul>", (int)id, "ResourceEnvironment", false);
                                        if (confirm)
                                        {
                                            await ReloadSpecificData("ResourceEnvironment");
                                            state.SetNavReload(true);
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "delete":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will delete the Environment and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        resourceEnvironment = servicesData.ResourceEnvironments!.Find(x => x.Id == id)!;
                                        if (GeneralHelper.IsNotNull(resourceEnvironment))
                                        {
                                            serviceResponse = await ResourceEnvironmentService!.DeleteItemAsync(Convert.ToInt32(resourceEnvironment.Id));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = resourceEnvironment.Name + " deleted!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = resourceEnvironment.Name + " deletion failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                        else
                                        {
                                            generalerror = true;
                                        }
                                    }
                                    break;
                                case "add":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        response = await ModalHelper.ShowAddModal(Modal!, servicesData, theme, "bg-navcolor", "Add Environment", "<p>Add an Environment.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li><li>Short Name must not contain spaces.</li></ul>", (int)id, "ResourceEnvironment", admin, "");
                                        if (response)
                                        {
                                            await ReloadSpecificData("ResourceEnvironment");
                                            state.SetNavReload(true);
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "uppercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>uppercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceEnvironments))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceEnvironments!, false, 
                                                async (item) => await ResourceEnvironmentService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to uppercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "lowercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>lowercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceEnvironments))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceEnvironments!, true, 
                                                async (item) => await ResourceEnvironmentService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to lowercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "download":
                                    serviceResponse = await ResourceEnvironmentService!.GetItemsAsync();
                                    if (serviceResponse.Success)
                                    {
                                        if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                        {
                                            var environmentjson = serviceResponse.ResponseObject;
                                            if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                            {
                                                await BlazorDownloadFileService.DownloadFileFromText("environmentsconfig.json", JsonSerializer.Serialize(environmentjson).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                            }
                                        }
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Environments Configuration to the default repository values and cannot be undone!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        var resetResult = await ResetConfigurationData<ResourceEnvironment>("resourceenvironments.json", ResourceEnvironmentService!.PostConfigAsync);
                                        if (resetResult.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Environments configuration reset! Page will refresh in 2 seconds...";
                                            
                                            // Force page refresh to show updated data
                                            await Task.Delay(2000);
                                            NavigationManager!.NavigateTo("/configuration", true);
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resetResult.Message;
                                            message.MessageDetails = resetResult.Details ?? string.Empty;
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newEnvironmentConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Environments Configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            serviceResponse = await ResourceEnvironmentService!.PostConfigAsync(JsonSerializer.Deserialize<List<ResourceEnvironment>>(newEnvironmentConfig, options)!);
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Resource Environments config update succeeded!";
                                                newEnvironmentConfig = String.Empty;
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Resource Environments config update failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                    }
                                    break;
                            }
                            serviceResponse = await ResourceEnvironmentService!.GetItemsAsync();
                            if (serviceResponse.Success)
                            {
                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                {
                                    servicesData.ResourceEnvironments = (List<ResourceEnvironment>)serviceResponse.ResponseObject!;
                                }
                            }
                            break;
                        case "ResourceFunction":
                            ResourceFunction resourceFunction;
                            switch (action)
                            {
                                case "up":
                                    // Get the component in the list
                                    resourceFunction = servicesData.ResourceFunctions!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceFunction))
                                    {
                                        if (resourceFunction.SortOrder > 1)
                                        {
                                            resourceFunction.SortOrder += -1;
                                        }
                                        serviceResponse = await ResourceFunctionService!.PostItemAsync(resourceFunction);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceFunction.Name + " moved up!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceFunction.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "down":
                                    resourceFunction = servicesData.ResourceFunctions!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceFunction))
                                    {
                                        if (resourceFunction.SortOrder <= servicesData.ResourceFunctions!.Count)
                                        {
                                            resourceFunction.SortOrder += 1;
                                        }
                                        serviceResponse = await ResourceFunctionService!.PostItemAsync(resourceFunction);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceFunction.Name + " moved down!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceFunction.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "edit":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        confirm = await ModalHelper.ShowEditModal(Modal, servicesData, theme, "bg-navcolor", "Edit Function", "<p>Edit the Function.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li></ul>", (int)id, "ResourceFunction", false);
                                        if (confirm)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "delete":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will delete the Function and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        resourceFunction = servicesData.ResourceFunctions!.Find(x => x.Id == id)!;
                                        if (GeneralHelper.IsNotNull(resourceFunction))
                                        {
                                            serviceResponse = await ResourceFunctionService!.DeleteItemAsync(Convert.ToInt32(resourceFunction.Id));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = resourceFunction.Name + " deleted!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = resourceFunction.Name + " deletion failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                        else
                                        {
                                            generalerror = true;
                                        }
                                    }
                                    break;
                                case "add":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        response = await ModalHelper.ShowAddModal(Modal!, servicesData, theme, "bg-navcolor", "Add Function", "<p>Add a Function.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li><li>Short Name must not contain spaces.</li></ul>", (int)id, "ResourceFunction", admin, "");
                                        if (response)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;

                                case "uppercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>uppercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceFunctions))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceFunctions!, false, 
                                                async (item) => await ResourceFunctionService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to uppercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "lowercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>lowercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceFunctions))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceFunctions!, true, 
                                                async (item) => await ResourceFunctionService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to lowercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "download":
                                    serviceResponse = await ResourceFunctionService!.GetItemsAsync();
                                    if (serviceResponse.Success)
                                    {
                                        if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                        {
                                            var functionjon = serviceResponse.ResponseObject;
                                            if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                            {
                                                await BlazorDownloadFileService.DownloadFileFromText("functionsconfig.json", JsonSerializer.Serialize(functionjon).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                            }
                                        }
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Functions Configuration to the default repository values and cannot be undone!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        var resetResult = await ResetConfigurationData<ResourceFunction>("resourcefunctions.json", ResourceFunctionService!.PostConfigAsync);
                                        if (resetResult.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Functions configuration reset! Page will refresh in 2 seconds...";
                                            
                                            // Force page refresh to show updated data
                                            await Task.Delay(2000);
                                            NavigationManager!.NavigateTo("/configuration", true);
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resetResult.Message;
                                            message.MessageDetails = resetResult.Details ?? string.Empty;
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newFunctionConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Functions Configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            serviceResponse = await ResourceFunctionService!.PostConfigAsync(JsonSerializer.Deserialize<List<ResourceFunction>>(newFunctionConfig, options)!);
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Functions configuration update succeeded!";
                                                newFunctionConfig = String.Empty;
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Functions configuration update failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                    }
                                    break;
                            }
                            serviceResponse = await ResourceFunctionService!.GetItemsAsync();
                            if (serviceResponse.Success)
                            {
                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                {
                                    servicesData.ResourceFunctions = (List<ResourceFunction>)serviceResponse.ResponseObject!;
                                }
                            }
                            break;
                        case "ResourceLocation":
                            AzureNamingTool.Models.ResourceLocation resourceLocation;
                            switch (action)
                            {
                                case "enable":
                                    resourceLocation = servicesData.ResourceLocations!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceLocation))
                                    {
                                        resourceLocation.Enabled = true;
                                        serviceResponse = await ResourceLocationService!.PostItemAsync(resourceLocation);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceLocation.Name + " enabled!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceLocation.Name + " enabling failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "disable":
                                    resourceLocation = servicesData.ResourceLocations!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceLocation))
                                    {
                                        resourceLocation.Enabled = false;
                                        serviceResponse = await ResourceLocationService!.PostItemAsync(resourceLocation);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceLocation.Name + " disabled!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceLocation.Name + " disabling failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "edit":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        confirm = await ModalHelper.ShowEditModal(Modal, servicesData, theme, "bg-navcolor", "Edit Location", "<p>Edit the Location.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li></ul>", (int)id, "ResourceLocation", false);
                                        if (confirm)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "add":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        response = await ModalHelper.ShowAddModal(Modal!, servicesData, theme, "bg-navcolor", "Add Location", "<p>Add a Location.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li><li>Short Name must not contain spaces.</li></ul>", (int)id, "ResourceLocation", admin, "");
                                        if (response)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "delete":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will delete the Location and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        resourceLocation = servicesData.ResourceLocations!.Find(x => x.Id == id)!;
                                        if (GeneralHelper.IsNotNull(resourceLocation))
                                        {
                                            serviceResponse = await ResourceLocationService!.DeleteItemAsync(Convert.ToInt32(resourceLocation.Id));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = resourceLocation.Name + " deleted!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = resourceLocation.Name + " deletion failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                        else
                                        {
                                            generalerror = true;
                                        }
                                    }
                                    break;

                                case "uppercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>uppercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceLocations))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceLocations!, false, 
                                                async (item) => await ResourceLocationService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to uppercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "lowercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>lowercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceLocations))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceLocations!, true, 
                                                async (item) => await ResourceLocationService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to lowercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "download":
                                    serviceResponse = await ResourceLocationService!.GetItemsAsync();
                                    var locationjson = serviceResponse.ResponseObject;
                                    if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                    {
                                        await BlazorDownloadFileService.DownloadFileFromText("locationsconfig.json", JsonSerializer.Serialize(locationjson).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                    }
                                    break;
                                case "refresh":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will refresh the current Locations Configuration with the latest configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        serviceResponse = await ResourceLocationService!.RefreshResourceLocationsAsync(refreshlocationshortnames);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Locations configuration refreshed!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Locations configuration refresh failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Locations Configuration to the default repository values and cannot be undone!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        var resetResult = await ResetConfigurationData<AzureNamingTool.Models.ResourceLocation>("resourcelocations.json", ResourceLocationService!.PostConfigAsync);
                                        if (resetResult.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Locations configuration reset! Page will refresh in 2 seconds...";
                                            
                                            // Force page refresh to show updated data
                                            await Task.Delay(2000);
                                            NavigationManager!.NavigateTo("/configuration", true);
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resetResult.Message;
                                            message.MessageDetails = resetResult.Details ?? string.Empty;
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newLocationConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Locations Configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            serviceResponse = await ResourceLocationService!.PostConfigAsync(JsonSerializer.Deserialize<List<AzureNamingTool.Models.ResourceLocation>>(newLocationConfig, options)!);
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Resource Locations config update succeeded!";
                                                newLocationConfig = String.Empty;
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Resource Locations config update failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                    }
                                    break;
                            }
                            serviceResponse = await ResourceLocationService!.GetItemsAsync();
                            if (serviceResponse.Success)
                            {
                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                {
                                    servicesData.ResourceLocations = (List<AzureNamingTool.Models.ResourceLocation>)serviceResponse.ResponseObject!;
                                }
                            }
                            break;
                        case "ResourceOrg":
                            ResourceOrg resourceOrg;
                            switch (action)
                            {
                                case "up":
                                    // Get the component in the list
                                    resourceOrg = servicesData.ResourceOrgs!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceOrg))
                                    {
                                        if (resourceOrg.SortOrder > 1)
                                        {
                                            resourceOrg.SortOrder += -1;
                                        }
                                        serviceResponse = await ResourceOrgService!.PostItemAsync(resourceOrg);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceOrg.Name + " moved up!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceOrg.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "down":
                                    resourceOrg = servicesData.ResourceOrgs!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceOrg))
                                    {
                                        if (resourceOrg.SortOrder <= servicesData.ResourceOrgs.Count)
                                        {
                                            resourceOrg.SortOrder += 1;
                                        }
                                        serviceResponse = await ResourceOrgService!.PostItemAsync(resourceOrg);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceOrg.Name + " moved down!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceOrg.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "edit":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        confirm = await ModalHelper.ShowEditModal(Modal, servicesData, theme, "bg-navcolor", "Edit Org", "<p>Edit the Org.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li></ul>", (int)id, "ResourceOrg", false);
                                        if (confirm)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "delete":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will delete the Org and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        resourceOrg = servicesData.ResourceOrgs!.Find(x => x.Id == id)!;
                                        if (GeneralHelper.IsNotNull(resourceOrg))
                                        {
                                            serviceResponse = await ResourceOrgService!.DeleteItemAsync(Convert.ToInt32(resourceOrg.Id));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = resourceOrg.Name + " deleted!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = resourceOrg.Name + " deletion failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                        else
                                        {
                                            generalerror = true;
                                        }
                                    }
                                    break;
                                case "add":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        response = await ModalHelper.ShowAddModal(Modal!, servicesData, theme, "bg-navcolor", "Add Org", "<p>Add an Org.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li><li>Short Name must not contain spaces.</li></ul>", (int)id, "ResourceOrg", admin, "");
                                        if (response)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;

                                case "uppercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>uppercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceOrgs))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceOrgs!, false, 
                                                async (item) => await ResourceOrgService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to uppercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "lowercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>lowercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceOrgs))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceOrgs!, true, 
                                                async (item) => await ResourceOrgService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to lowercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "download":
                                    serviceResponse = await ResourceOrgService!.GetItemsAsync();
                                    if (serviceResponse.Success)
                                    {
                                        if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                        {
                                            var orgjson = serviceResponse.ResponseObject;
                                            if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                            {
                                                await BlazorDownloadFileService.DownloadFileFromText("orgsconfig.json", JsonSerializer.Serialize(orgjson).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                            }
                                        }
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Orgs Configuration to the default repository values and cannot be undone!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        var resetResult = await ResetConfigurationData<ResourceOrg>("resourceorgs.json", ResourceOrgService!.PostConfigAsync);
                                        if (resetResult.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Orgs configuration reset! Page will refresh in 2 seconds...";
                                            
                                            // Force page refresh to show updated data
                                            await Task.Delay(2000);
                                            NavigationManager!.NavigateTo("/configuration", true);
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resetResult.Message;
                                            message.MessageDetails = resetResult.Details ?? string.Empty;
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newOrgConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Orgs Configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            serviceResponse = await ResourceOrgService!.PostConfigAsync(JsonSerializer.Deserialize<List<ResourceOrg>>(newOrgConfig, options)!);
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Resource Orgs config update succeeded!";
                                                newOrgConfig = String.Empty;
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Resource Orgs config update failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                    }
                                    break;
                            }
                            serviceResponse = await ResourceOrgService!.GetItemsAsync();
                            if (serviceResponse.Success)
                            {
                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                {
                                    servicesData.ResourceOrgs = (List<ResourceOrg>)serviceResponse.ResponseObject!;
                                }
                            }
                            break;
                        case "ResourceProjAppSvc":
                            ResourceProjAppSvc resourceProjAppSvc;
                            switch (action)
                            {
                                case "up":
                                    // Get the component in the list
                                    resourceProjAppSvc = servicesData.ResourceProjAppSvcs!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceProjAppSvc))
                                    {
                                        if (resourceProjAppSvc.SortOrder > 1)
                                        {
                                            resourceProjAppSvc.SortOrder += -1;
                                        }
                                        serviceResponse = await ResourceProjAppSvcService!.PostItemAsync(resourceProjAppSvc);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceProjAppSvc.Name + " moved up!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceProjAppSvc.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "down":
                                    resourceProjAppSvc = servicesData.ResourceProjAppSvcs!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceProjAppSvc))
                                    {
                                        if (resourceProjAppSvc.SortOrder <= servicesData.ResourceProjAppSvcs.Count)
                                        {
                                            resourceProjAppSvc.SortOrder += 1;
                                        }
                                        serviceResponse = await ResourceProjAppSvcService!.PostItemAsync(resourceProjAppSvc);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceProjAppSvc.Name + " moved down!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceProjAppSvc.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "edit":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        confirm = await ModalHelper.ShowEditModal(Modal, servicesData, theme, "bg-navcolor", "Edit Project/App/Service", "<p>Edit the Project/App/Service.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li></ul>", (int)id, "ResourceProjAppSvc", false);
                                        if (confirm)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "delete":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will delete the Project/App/Service and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        resourceProjAppSvc = servicesData.ResourceProjAppSvcs!.Find(x => x.Id == id)!;
                                        if (GeneralHelper.IsNotNull(resourceProjAppSvc))
                                        {
                                            serviceResponse = await ResourceProjAppSvcService!.DeleteItemAsync(Convert.ToInt32(resourceProjAppSvc.Id));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = resourceProjAppSvc.Name + " deleted!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = resourceProjAppSvc.Name + " deletion failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                        else
                                        {
                                            generalerror = true;
                                        }
                                    }
                                    break;
                                case "add":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        response = await ModalHelper.ShowAddModal(Modal!, servicesData, theme, "bg-navcolor", "Add Project/App/Service", "<p>Add an Project/App/Service.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li><li>Short Name must not contain spaces.</li></ul>", (int)id, "ResourceProjAppSvc", admin, "");
                                        if (response)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;

                                case "uppercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>uppercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceProjAppSvcs))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceProjAppSvcs!, false, 
                                                async (item) => await ResourceProjAppSvcService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to uppercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "lowercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>lowercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceProjAppSvcs))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceProjAppSvcs!, true, 
                                                async (item) => await ResourceProjAppSvcService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to lowercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "download":
                                    serviceResponse = await ResourceProjAppSvcService!.GetItemsAsync();
                                    if (serviceResponse.Success)
                                    {
                                        if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                        {
                                            var projappsvcjson = serviceResponse.ResponseObject;
                                            if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                            {
                                                await BlazorDownloadFileService.DownloadFileFromText("projappsvcsconfig.json", JsonSerializer.Serialize(projappsvcjson).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                            }
                                        }
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Projects/Apps/Services Configuration to the default repository values and cannot be undone!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        var resetResult = await ResetConfigurationData<ResourceProjAppSvc>("resourceprojappsvcs.json", ResourceProjAppSvcService!.PostConfigAsync);
                                        if (resetResult.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Projects/Apps/Services configuration reset! Page will refresh in 2 seconds...";
                                            
                                            // Force page refresh to show updated data
                                            await Task.Delay(2000);
                                            NavigationManager!.NavigateTo("/configuration", true);
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resetResult.Message;
                                            message.MessageDetails = resetResult.Details ?? string.Empty;
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newProjAppSvcConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Projects/Apps/Services Configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            serviceResponse = await ResourceProjAppSvcService!.PostConfigAsync(JsonSerializer.Deserialize<List<ResourceProjAppSvc>>(newProjAppSvcConfig, options)!);
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "ProjAppSvcs configuration update succeeded!";
                                                newProjAppSvcConfig = String.Empty;
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "ProjAppSvcs configuration update failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                    }
                                    break;
                            }
                            serviceResponse = await ResourceProjAppSvcService!.GetItemsAsync();
                            if (serviceResponse.Success)
                            {
                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                {
                                    servicesData.ResourceProjAppSvcs = (List<ResourceProjAppSvc>)serviceResponse.ResponseObject!;
                                }
                            }
                            break;
                        case "ResourceType":
                            ResourceType resourceType = new();
                            switch (action)
                            {
                                case "enable":
                                    resourceType = servicesData.ResourceTypes!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceType))
                                    {
                                        resourceType.Enabled = true;
                                        serviceResponse = await ResourceTypeService!.PostItemAsync(resourceType);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceType.Resource + " enabled!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceType.Resource + " enabling failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "disable":
                                    resourceType = servicesData.ResourceTypes!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceType))
                                    {
                                        resourceType.Enabled = false;
                                        serviceResponse = await ResourceTypeService!.PostItemAsync(resourceType);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceType.Resource + " disabled!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceType.Resource + " disabling failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "edit":
                                    resourceType = servicesData.ResourceTypes!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceType))
                                    {
                                        confirm = await ModalHelper.ShowEditModal(Modal, servicesData, theme, "bg-navcolor", "Edit Resource Type", "<p>Edit the Resource Type.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + resourceType.LengthMin + "-" + resourceType.LengthMax + " characters.</li></ul>", (int)id, "ResourceType", false);
                                        if (confirm)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;

                                case "delete":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will delete the Resource Type and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        resourceType = servicesData.ResourceTypes!.Find(x => x.Id == id)!;
                                        if (GeneralHelper.IsNotNull(resourceType))
                                        {
                                            serviceResponse = await ResourceTypeService!.DeleteItemAsync(Convert.ToInt32(resourceType.Id));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = resourceType.Resource + " deleted!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = resourceType.Resource + " deletion failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                        else
                                        {
                                            generalerror = true;
                                        }
                                    }
                                    break;
                                case "add":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        response = await ModalHelper.ShowAddModal(Modal!, servicesData, theme, "bg-navcolor", "Add Resource Type", "<p>Add a Resource Type.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li><li>Short Name must not contain spaces.</li></ul>", (int)id, "ResourceType", admin, "");
                                        if (response)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "uppercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>uppercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceTypes))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceTypes!, false, 
                                                async (item) => await ResourceTypeService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to uppercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options updated failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "lowercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>lowercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceTypes))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceTypes!, true, 
                                                async (item) => await ResourceTypeService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to lowercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "download":
                                    serviceResponse = await ResourceTypeService!.GetItemsAsync();
                                    if (serviceResponse.Success)
                                    {
                                        if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                        {
                                            var typejson = serviceResponse.ResponseObject;
                                            if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                            {
                                                await BlazorDownloadFileService.DownloadFileFromText("typesconfig.json", JsonSerializer.Serialize(typejson).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                            }
                                        }
                                    }
                                    break;
                                case "refresh":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will refresh the current Types Configuration with the latest configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        serviceResponse = await ResourceTypeService!.RefreshResourceTypesAsync(refreshtypeshortnames);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Types configuration refreshed!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Types configuration refresh failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Types Configuration to the default repository values and cannot be undone!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        var resetResult = await ResetConfigurationData<ResourceType>("resourcetypes.json", ResourceTypeService!.PostConfigAsync);
                                        if (resetResult.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Types configuration reset! Page will refresh in 2 seconds...";
                                            
                                            // Force page refresh to show updated data
                                            await Task.Delay(2000);
                                            NavigationManager!.NavigateTo("/configuration", true);
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resetResult.Message;
                                            message.MessageDetails = resetResult.Details ?? string.Empty;
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newTypeConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Types Configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            serviceResponse = await ResourceTypeService!.PostConfigAsync(JsonSerializer.Deserialize<List<ResourceType>>(newTypeConfig, options)!);
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Types configuration update succeeded!";
                                                newTypeConfig = String.Empty;
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Types configuration update failed! Please check the Admin Log for details. " + serviceResponse.ResponseObject;
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                    }
                                    break;
                            }
                            serviceResponse = await ResourceTypeService!.GetItemsAsync();
                            if (serviceResponse.Success)
                            {
                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                {
                                    servicesData.ResourceTypes = (List<ResourceType>)serviceResponse.ResponseObject!;
                                }
                            }
                            break;
                        case "ResourceUnitDept":
                            ResourceUnitDept resourceUnitDept;
                            switch (action)
                            {
                                case "up":
                                    // Get the component in the list
                                    resourceUnitDept = servicesData.ResourceUnitDepts!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceUnitDept))
                                    {
                                        if (resourceUnitDept.SortOrder > 1)
                                        {
                                            resourceUnitDept.SortOrder += -1;
                                        }
                                        serviceResponse = await ResourceUnitDeptService!.PostItemAsync(resourceUnitDept);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceUnitDept.Name + " moved up!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceUnitDept.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "down":
                                    resourceUnitDept = servicesData.ResourceUnitDepts!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(resourceUnitDept))
                                    {
                                        if (resourceUnitDept.SortOrder <= servicesData.ResourceUnitDepts.Count)
                                        {
                                            resourceUnitDept.SortOrder += 1;
                                        }
                                        serviceResponse = await ResourceUnitDeptService!.PostItemAsync(resourceUnitDept);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = resourceUnitDept.Name + " moved down!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resourceUnitDept.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "edit":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        confirm = await ModalHelper.ShowEditModal(Modal, servicesData, theme, "bg-navcolor", "Edit Unit/Dept", "<p>Edit the Unit/Dept.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li></ul>", (int)id, "ResourceUnitDept", false);
                                        if (confirm)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "delete":

                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will delete the Unit/Dept and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        resourceUnitDept = servicesData.ResourceUnitDepts!.Find(x => x.Id == id)!;
                                        if (GeneralHelper.IsNotNull(resourceUnitDept))
                                        {
                                            serviceResponse = await ResourceUnitDeptService!.DeleteItemAsync(Convert.ToInt32(resourceUnitDept.Id));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = resourceUnitDept.Name + " deleted!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = resourceUnitDept.Name + " deletion failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                        else
                                        {
                                            generalerror = true;
                                        }
                                    }
                                    break;
                                case "add":
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        response = await ModalHelper.ShowAddModal(Modal!, servicesData, theme, "bg-navcolor", "Add Unit/Dept", "<p>Add a Unit/Dept.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li><li>Short Name must not contain spaces.</li></ul>", (int)id, "ResourceUnitDept", admin, "");
                                        if (response)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;

                                case "uppercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>uppercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceUnitDepts))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceUnitDepts!, false, 
                                                async (item) => await ResourceUnitDeptService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to uppercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "lowercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>lowercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.ResourceUnitDepts))
                                        {
                                            serviceResponse = await ConvertCaseAsync(servicesData.ResourceUnitDepts!, true, 
                                                async (item) => await ResourceUnitDeptService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Options updated to lowercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = "Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "download":
                                    serviceResponse = await ResourceUnitDeptService!.GetItemsAsync();
                                    if (serviceResponse.Success)
                                    {
                                        if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                        {
                                            var unitdeptjson = serviceResponse.ResponseObject;
                                            if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                            {
                                                await BlazorDownloadFileService.DownloadFileFromText("unitdeptsconfig.json", JsonSerializer.Serialize(unitdeptjson).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                            }
                                        }
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Units/Depts Configuration to the default repository values and cannot be undone!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        var resetResult = await ResetConfigurationData<ResourceUnitDept>("resourceunitdepts.json", ResourceUnitDeptService!.PostConfigAsync);
                                        if (resetResult.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Units/Depts configuration reset! Page will refresh in 2 seconds...";
                                            
                                            // Force page refresh to show updated data
                                            await Task.Delay(2000);
                                            NavigationManager!.NavigateTo("/configuration", true);
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resetResult.Message;
                                            message.MessageDetails = resetResult.Details ?? string.Empty;
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newUnitDeptConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Units/Depts Configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            serviceResponse = await ResourceUnitDeptService!.PostConfigAsync(JsonSerializer.Deserialize<List<ResourceUnitDept>>(newUnitDeptConfig, options)!);
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Units/Depts configuration update succeeded!";
                                                newFunctionConfig = String.Empty;
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Units/Depts configuration update failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                    }
                                    break;
                            }
                            serviceResponse = await ResourceUnitDeptService!.GetItemsAsync();
                            if (serviceResponse.Success)
                            {
                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                {
                                    servicesData.ResourceUnitDepts = (List<ResourceUnitDept>)serviceResponse.ResponseObject!;
                                }
                            }
                            break;
                        case "CustomComponent":
                            CustomComponent customComponent;
                            switch (action)
                            {
                                case "up":
                                    // Get the component in the list
                                    customComponent = servicesData.CustomComponents!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(customComponent))
                                    {
                                        if (customComponent.SortOrder > 1)
                                        {
                                            customComponent.SortOrder += -1;
                                        }
                                        serviceResponse = await CustomComponentService!.PostItemAsync(customComponent);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = customComponent.Name + " moved up!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = customComponent.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "down":
                                    customComponent = servicesData.CustomComponents!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(customComponent))
                                    {
                                        if (customComponent.SortOrder <= servicesData.CustomComponents.Count)
                                        {
                                            customComponent.SortOrder += 1;
                                        }
                                        serviceResponse = await CustomComponentService!.PostItemAsync(customComponent);
                                        if (serviceResponse.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = customComponent.Name + " moved down!";
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = customComponent.Name + " move failed! Please check the Admin Log for details.";
                                            message.MessageDetails = serviceResponse.ResponseMessage;
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "add":
                                    // Get the component in the list
                                    if (GeneralHelper.IsNotNull(thisresourceComponent))
                                    {
                                        response = await ModalHelper.ShowAddModal(Modal!, servicesData, theme, "bg-navcolor", "Add Custom Component", "<p>Add a Custom Component.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li><li>Short Name must not contain spaces.</li></ul>", (int)id, "CustomComponent", admin, parentcomponent);
                                        if (response)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "edit":
                                    // Get the component in the list
                                    customComponent = servicesData.CustomComponents!.Find(x => x.Id == id)!;
                                    if (GeneralHelper.IsNotNull(customComponent))
                                    {
                                        confirm = await ModalHelper.ShowEditModal(Modal, servicesData, theme, "bg-navcolor", "Edit Custom Component", "<p>Edit the Custom Component.</p><p><span style='font-weight: 600;'>NOTES</span></p><ul><li>Short Name value will be converted to lower case.</li><li>Short Name must be " + thisresourceComponent.MinLength + "-" + thisresourceComponent.MaxLength + " characters.</li></ul>", (int)id, "CustomComponent", false, customComponent.ParentComponent);
                                        if (confirm)
                                        {
                                            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                                            state.SetNavReload(true);
                                            StateHasChanged();
                                        }
                                    }
                                    else
                                    {
                                        generalerror = true;
                                    }
                                    break;
                                case "delete":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will delete the Custom Component and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        customComponent = servicesData.CustomComponents!.Find(x => x.Id == id)!;
                                        if (GeneralHelper.IsNotNull(customComponent))
                                        {
                                            serviceResponse = await CustomComponentService!.DeleteItemAsync(Convert.ToInt32(customComponent.Id));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = customComponent.Name + " deleted!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = customComponent.Name + " deletion failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                        else
                                        {
                                            generalerror = true;
                                        }
                                    }
                                    break;
                                case "uppercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>uppercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.CustomComponents))
                                        {
                                            List<CustomComponent> lstcomponents = servicesData.CustomComponents.Where(x => x.ParentComponent == GeneralHelper.NormalizeName(parentcomponent, true)).ToList();
                                            serviceResponse = await ConvertCaseAsync(lstcomponents, false, 
                                                async (item) => await CustomComponentService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = parentcomponent + " - Options updated to uppercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = parentcomponent + " - Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = parentcomponent + " - Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "lowercase":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update all the short names to <span style='font-weight: 600;'>lowercase</span> characters!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        if (GeneralHelper.IsNotNull(servicesData.CustomComponents))
                                        {
                                            List<CustomComponent> lstcomponents = servicesData.CustomComponents.Where(x => x.ParentComponent == GeneralHelper.NormalizeName(parentcomponent, true)).ToList();
                                            serviceResponse = await ConvertCaseAsync(lstcomponents, true, 
                                                async (item) => await CustomComponentService!.PostItemAsync(item));
                                            if (serviceResponse.Success)
                                            {
                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = parentcomponent + " - Options updated to lowercase!";
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = parentcomponent + " - Options update failed! Please check the Admin Log for details.";
                                            }
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = parentcomponent + " - Options update failed! Please check the Admin Log for details.";
                                        }
                                    }
                                    break;
                                case "download":
                                    bool valid = false;
                                    CustomComponmentConfig customcomponentconfigexport = new();
                                    // Get the custom components
                                    serviceResponse = await ResourceComponentService!.GetItemsAsync(true);
                                    if (serviceResponse.Success)
                                    {
                                        if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                        {
                                            List<ResourceComponent> components = serviceResponse.ResponseObject!;
                                            if (GeneralHelper.IsNotNull(components))
                                            {
                                                customcomponentconfigexport.ParentComponents = components.Where(x => x.IsCustom == true).ToList();

                                                // Get the custom component options
                                                serviceResponse = await CustomComponentService!.GetItemsAsync();
                                                if (serviceResponse.Success)
                                                {
                                                    if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                                    {
                                                        customcomponentconfigexport.CustomComponents = serviceResponse.ResponseObject!;
                                                        valid = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if (valid)
                                    {
                                        if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                        {
                                            await BlazorDownloadFileService.DownloadFileFromText("customcomponents.json", JsonSerializer.Serialize(customcomponentconfigexport).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                        }
                                    }
                                    else
                                    {
                                        message.Type = MessageTypesEnum.ERROR;
                                        message.Message = "There was a problem exporting the custom components.  Please check the Admin Log for details.";
                                        message.MessageDetails = serviceResponse.ResponseMessage;
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Custom Components Configuration to the default repository values and cannot be undone!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        var resetResult = await ResetConfigurationData<CustomComponent>("customcomponents.json", CustomComponentService!.PostConfigAsync);
                                        if (resetResult.Success)
                                        {
                                            message.Type = MessageTypesEnum.SUCCESS;
                                            message.Message = "Custom Components configuration reset! Page will refresh in 2 seconds...";
                                            
                                            // Force page refresh to show updated data
                                            await Task.Delay(2000);
                                            NavigationManager!.NavigateTo("/configuration", true);
                                        }
                                        else
                                        {
                                            message.Type = MessageTypesEnum.ERROR;
                                            message.Message = resetResult.Message;
                                            message.MessageDetails = resetResult.Details ?? string.Empty;
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newCustomComponentConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Custom Components Configuration and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            List<ResourceComponent> currentresourcecomponents = new();
                                            List<CustomComponent> newcustomcomponents = new();
                                            // Get the current resource components
                                            serviceResponse = await ResourceComponentService!.GetItemsAsync(true);
                                            if (serviceResponse.Success)
                                            {
                                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                                {
                                                    currentresourcecomponents = serviceResponse.ResponseObject!;
                                                    // Format the posted configuration
                                                    try
                                                    {
                                                        CustomComponmentConfig customcomponentconfigupdate = JsonSerializer.Deserialize<CustomComponmentConfig>(newCustomComponentConfig, options)!;
                                                        if (GeneralHelper.IsNotNull(customcomponentconfigupdate))
                                                        {
                                                            // Check if the configuration contains resource components
                                                            if (customcomponentconfigupdate.ParentComponents!.Count > 0)
                                                            {
                                                                // Loop through the posted components
                                                                foreach (ResourceComponent thisparentcomponent in customcomponentconfigupdate.ParentComponents)
                                                                {
                                                                    // Check if the posted component exists in the current components
                                                                    if (!currentresourcecomponents.Exists(x => x.Name == thisparentcomponent.Name))
                                                                    {
                                                                        // Add the custom component
                                                                        ResourceComponent newcustomcomponent = new()
                                                                            {
                                                                                Name = thisparentcomponent.Name,
                                                                                DisplayName = thisparentcomponent.Name,
                                                                                IsCustom = true,
                                                                                IsFreeText = thisparentcomponent.IsFreeText
                                                                            };
                                                                        serviceResponse = await ResourceComponentService!.PostItemAsync(newcustomcomponent);
                                                                        // Add the new custom component to the list
                                                                        currentresourcecomponents.Add(newcustomcomponent);
                                                                    }
                                                                }
                                                            }
                                                            if (customcomponentconfigupdate.CustomComponents!.Count > 0)
                                                            {
                                                                // Loop through custom components to make sure the parent exists
                                                                foreach (CustomComponent thiscustomcomponent in customcomponentconfigupdate.CustomComponents)
                                                                {
                                                                    if (currentresourcecomponents.Where(x => GeneralHelper.NormalizeName(x.Name, true) == thiscustomcomponent.ParentComponent).Count() > 0)
                                                                    {
                                                                        newcustomcomponents.Add(thiscustomcomponent);
                                                                    }
                                                                }

                                                                // Update the custom component options
                                                                serviceResponse = await CustomComponentService!.PostConfigAsync(newcustomcomponents);
                                                            }
                                                        }
                                                    }
                                                    catch (Exception)
                                                    {
                                                        // User is likely trying to import just components.
                                                        List<CustomComponent> customComponents = JsonSerializer.Deserialize<List<CustomComponent>>(newCustomComponentConfig, options)!;
                                                        if (GeneralHelper.IsNotNull(customComponents))
                                                        {
                                                            // Loop through custom components to make sure the parent exists
                                                            foreach (CustomComponent thiscustomcomponent in customComponents)
                                                            {
                                                                if (GeneralHelper.IsNotNull(currentresourcecomponents))
                                                                {
                                                                    if (currentresourcecomponents.Where(x => GeneralHelper.NormalizeName(x.Name, true) == thiscustomcomponent.ParentComponent).Count() > 0)
                                                                    {
                                                                        newcustomcomponents.Add(thiscustomcomponent);
                                                                    }
                                                                }
                                                            }
                                                            // Update the custom component options
                                                            serviceResponse = await CustomComponentService!.PostConfigAsync(newcustomcomponents);
                                                        }
                                                    }
                                                }
                                            }
                                            if (serviceResponse.Success)
                                            {

                                                message.Type = MessageTypesEnum.SUCCESS;
                                                message.Message = "Custom Components configuration update succeeded!";
                                                newFunctionConfig = String.Empty;
                                            }
                                            else
                                            {
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = "Custom Components configuration update failed! Please check the Admin Log for details.";
                                                message.MessageDetails = serviceResponse.ResponseMessage;
                                            }
                                        }
                                    }
                                    break;
                            }
                            serviceResponse = await CustomComponentService!.GetItemsAsync();
                            if (serviceResponse.Success)
                            {
                                if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                {
                                    servicesData.CustomComponents = (List<CustomComponent>)serviceResponse.ResponseObject!;
                                }
                            }
                            break;
                        case "Global":
                            switch (action)
                            {
                                case "download":
                                    serviceResponse = await ImportExportService!.ExportConfigAsync(includeAdmin);
                                    if (serviceResponse.Success)
                                    {
                                        if (GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                                        {
                                            var globaljson = serviceResponse.ResponseObject;
                                            if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                            {
                                                await BlazorDownloadFileService.DownloadFileFromText("globalconfig.json", JsonSerializer.Serialize(globaljson).ToString(), System.Text.Encoding.UTF8, "application/octet-stream");
                                            }
                                        }
                                    }
                                    break;
                                case "reset":
                                    confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the current Global Configuration for all settings and cannot be undone!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                    if (confirm)
                                    {
                                        bool confirmglobalreset = await ModalHelper.ShowTextConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'><span style='font-weight: 600;'>Every setting of the site will be reset if you continue!</span></div><div style='margin: 1.5rem 0;'>It is recommended you take a backup of the configuration before proceeding!</div><div style='margin: 1.5rem 0;'><strong>Type CONFIRM to proceed:</strong></div>", "CONFIRM", "bg-danger", theme);
                                        if (confirmglobalreset)
                                        {
                                            try
                                            {
                                                // Log the global reset attempt
                                                await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                                                { 
                                                    Title = "INFORMATION", 
                                                    Message = $"Global configuration reset started. Storage mode: {currentStorageProvider}" 
                                                });

                                                if (isUsingSQLite)
                                                {
                                                    // For SQLite: Load all configuration from repository JSON files and save to database
                                                    var repositoryPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "repository");
                                                    
                                                    // Reset all components using ImportExportService
                                                    // This loads from repository files and saves to database
                                                    var configData = new ConfigurationData();
                                                    
                                                    // Load each configuration type from repository
                                                    JsonSerializerOptions jsonOptions = new JsonSerializerOptions
                                                    {
                                                        PropertyNameCaseInsensitive = true
                                                    };
                                                    
                                                    // Load resource components
                                                    var componentsJson = await File.ReadAllTextAsync(Path.Combine(repositoryPath, "resourcecomponents.json"));
                                                    configData.ResourceComponents = JsonSerializer.Deserialize<List<ResourceComponent>>(componentsJson, jsonOptions)!;
                                                    
                                                    // Load resource delimiters
                                                    var delimitersJson = await File.ReadAllTextAsync(Path.Combine(repositoryPath, "resourcedelimiters.json"));
                                                    configData.ResourceDelimiters = JsonSerializer.Deserialize<List<ResourceDelimiter>>(delimitersJson, jsonOptions)!;
                                                    
                                                    // Load resource environments
                                                    var environmentsJson = await File.ReadAllTextAsync(Path.Combine(repositoryPath, "resourceenvironments.json"));
                                                    configData.ResourceEnvironments = JsonSerializer.Deserialize<List<ResourceEnvironment>>(environmentsJson, jsonOptions)!;
                                                    
                                                    // Load resource functions
                                                    var functionsJson = await File.ReadAllTextAsync(Path.Combine(repositoryPath, "resourcefunctions.json"));
                                                    configData.ResourceFunctions = JsonSerializer.Deserialize<List<ResourceFunction>>(functionsJson, jsonOptions)!;
                                                    
                                                    // Load resource locations
                                                    var locationsJson = await File.ReadAllTextAsync(Path.Combine(repositoryPath, "resourcelocations.json"));
                                                    configData.ResourceLocations = JsonSerializer.Deserialize<List<AzureNamingTool.Models.ResourceLocation>>(locationsJson, jsonOptions)!;
                                                    
                                                    // Load resource orgs
                                                    var orgsJson = await File.ReadAllTextAsync(Path.Combine(repositoryPath, "resourceorgs.json"));
                                                    configData.ResourceOrgs = JsonSerializer.Deserialize<List<ResourceOrg>>(orgsJson, jsonOptions)!;
                                                    
                                                    // Load resource project/app/services
                                                    var projappsvcJson = await File.ReadAllTextAsync(Path.Combine(repositoryPath, "resourceprojappsvcs.json"));
                                                    configData.ResourceProjAppSvcs = JsonSerializer.Deserialize<List<ResourceProjAppSvc>>(projappsvcJson, jsonOptions)!;
                                                    
                                                    // Load resource types
                                                    var typesJson = await File.ReadAllTextAsync(Path.Combine(repositoryPath, "resourcetypes.json"));
                                                    configData.ResourceTypes = JsonSerializer.Deserialize<List<ResourceType>>(typesJson, jsonOptions)!;
                                                    
                                                    // Load resource unit/depts
                                                    var unitdeptsJson = await File.ReadAllTextAsync(Path.Combine(repositoryPath, "resourceunitdepts.json"));
                                                    configData.ResourceUnitDepts = JsonSerializer.Deserialize<List<ResourceUnitDept>>(unitdeptsJson, jsonOptions)!;
                                                    
                                                    // Load custom components
                                                    var customcomponentsJson = await File.ReadAllTextAsync(Path.Combine(repositoryPath, "customcomponents.json"));
                                                    configData.CustomComponents = JsonSerializer.Deserialize<List<CustomComponent>>(customcomponentsJson, jsonOptions)!;
                                                    
                                                    await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                                                    { 
                                                        Title = "INFORMATION", 
                                                        Message = $"Global reset: Loaded all configuration from repository. Calling PostConfigAsync to save to database..." 
                                                    });
                                                    
                                                    // Save all configuration to database
                                                    var postResponse = await ImportExportService!.PostConfigAsync(configData);
                                                    
                                                    if (postResponse.Success)
                                                    {
                                                        await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                                                        { 
                                                            Title = "SUCCESS", 
                                                            Message = "Global reset: All configuration saved to database successfully" 
                                                        });
                                                        
                                                        message.Type = MessageTypesEnum.SUCCESS;
                                                        message.Message = "Global configuration reset! Page will refresh in 2 seconds...";
                                                        
                                                        // Force page refresh to show updated data
                                                        await Task.Delay(2000);
                                                        NavigationManager!.NavigateTo("/configuration", true);
                                                    }
                                                    else
                                                    {
                                                        await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                                                        { 
                                                            Title = "ERROR", 
                                                            Message = $"Global reset failed: {postResponse.ResponseMessage}" 
                                                        });
                                                        
                                                        message.Type = MessageTypesEnum.ERROR;
                                                        message.Message = "Global configuration reset failed! Please check the Admin Log for details.";
                                                        message.MessageDetails = postResponse.ResponseMessage;
                                                    }
                                                }
                                                else
                                                {
                                                    // For FileSystem: Use existing method which copies files and clears cache
                                                    if (ConfigurationHelper.ResetSiteConfiguration())
                                                    {
                                                        await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                                                        { 
                                                            Title = "SUCCESS", 
                                                            Message = "Global reset (FileSystem): Files copied and cache cleared" 
                                                        });
                                                        
                                                        message.Type = MessageTypesEnum.SUCCESS;
                                                        message.Message = "Global configuration reset! Page will refresh in 2 seconds...";
                                                        
                                                        // Force page refresh to show updated data
                                                        await Task.Delay(2000);
                                                        NavigationManager!.NavigateTo("/configuration", true);
                                                    }
                                                    else
                                                    {
                                                        message.Type = MessageTypesEnum.ERROR;
                                                        message.Message = "Global configuration reset failed! Please check the Admin Log for details.";
                                                    }
                                                }
                                            }
                                            catch (Exception ex)
                                            {
                                                await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                                                { 
                                                    Title = "ERROR", 
                                                    Message = $"Global reset exception: {ex.Message}\nStackTrace: {ex.StackTrace}" 
                                                });
                                                
                                                message.Type = MessageTypesEnum.ERROR;
                                                message.Message = $"Global configuration reset failed: {ex.Message}";
                                            }
                                        }
                                    }
                                    break;
                                case "update":
                                    if (GeneralHelper.IsNotNull(newGlobalConfig))
                                    {
                                        confirm = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'>This will update the current Global Configuration and cannot be undone!!</div><div style='margin: 1.5rem 0;'>Are you sure?</div>", "bg-danger", theme);
                                        if (confirm)
                                        {
                                            bool confirmglobalupdate = await ModalHelper.ShowConfirmationModal(Modal!, "ATTENTION", "<div style='margin: 1.5rem 0;'><span style='font-weight: 600;'>Every setting of the site will be updated if you continue!</span></div><div style='margin: 1.5rem 0;'>It is recommended you take a backup of the configuration before proceeding!</div><div style='margin: 1.5rem 0;'>Continue?</div>", "bg-danger", theme);
                                            if (confirmglobalupdate)
                                            {
                                                serviceResponse = await ImportExportService!.PostConfigAsync(JsonSerializer.Deserialize<ConfigurationData>(newGlobalConfig, options)!);
                                                if (serviceResponse.Success)
                                                {
                                                    message.Type = MessageTypesEnum.SUCCESS;
                                                    message.Message = "Global config update succeeded!";
                                                    newGlobalConfig = String.Empty;
                                                }
                                                else
                                                {
                                                    message.Type = MessageTypesEnum.ERROR;
                                                    message.Message = "Global config update failed! Please check the Admin Log for details.";
                                                    message.MessageDetails = serviceResponse.ResponseMessage;
                                                }
                                            }
                                        }
                                    }
                                    break;
                            }
                            break;
                        case "Policy":
                            switch (action)
                            {
                                case "download":
                                    serviceResponse = await PolicyService!.GetPolicyAsync();
                                    var policyjson = serviceResponse.ResponseObject;

                                    var stream = new MemoryStream();
                                    var writer = new StreamWriter(stream);
                                    writer.Write(serviceResponse.ResponseObject);
                                    writer.Flush();
                                    stream.Position = 0;

                                    string policyString = Encoding.Default.GetString(stream.ToArray());
                                    if (GeneralHelper.IsNotNull(BlazorDownloadFileService))
                                    {
                                        await BlazorDownloadFileService.DownloadFileFromText("namePolicyDefinition.json", policyString, System.Text.Encoding.UTF8, "application/json");
                                    }
                                    break;
                            }
                            break;
                    }

                    // Reset cache items
                    CacheHelper.InvalidateCacheObject(type);
                    await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
                }
                catch (Exception ex)
                {
                    await AdminLogService!.PostItemAsync(new AdminLogMessage() { Title = "ERROR", Message = ex.Message });
                    message.Type = MessageTypesEnum.ERROR;
                    message.Message = "There was a problem with the request. Please check the Admin Log for details.";
                }

                workingmodal.Close();
            }

            if (!generalerror)
            {
                if (!String.IsNullOrEmpty(message.Message))
                {
                    message.Message = "(" + type + ") " + message.Message;
                    switch (message.Type)
                    {
                        case MessageTypesEnum.INFORMATION:
                            toastService.ShowInfo(message.Message);
                            break;
                        case MessageTypesEnum.SUCCESS:
                            toastService.ShowSuccess(message.Message);
                            break;
                        case MessageTypesEnum.WARNING:
                            toastService.ShowWarning(message.Message);
                            break;
                        case MessageTypesEnum.ERROR:
                            toastService.ShowError(message.Message);
                            break;
                    }

                    // Get the current user, if any
                    string currentuser = await IdentityHelper.GetCurrentUser(session);
                    await AdminLogService!.PostItemAsync(new AdminLogMessage() { Title = message.Type.ToString(), Message = message.Message, Source = currentuser });
                }
            }
            else
            {
                toastService.ShowError("There was an error with teh request.  Please check the Admin Log for details.");
            }
        }
        else
        {
            await ReloadSpecificData("ResourceComponent", "ResourceDelimiter", "ResourceEnvironment", "ResourceLocation", "ResourceOrg", "ResourceProjAppSvc", "ResourceType", "ResourceUnitDept", "ResourceFunction", "CustomComponent");
            toastService.ShowError("There was an error with the request.  Please check the Admin Log for details.");
        }
    }

    private void SetFormValue(string type, string value)
    {
        switch (type)
        {
            case "newComponentConfig":
                newComponentConfig = value;
                break;
            case "newDelimiterConfig":
                newDelimiterConfig = value;
                break;
            case "newEnvironmentName":
                newEnvironmentName = value;
                break;
            case "newEnvironmentShortName":
                newEnvironmentShortName = value;
                break;
            case "newEnvironmentConfig":
                newEnvironmentConfig = value;
                break;
            case "newLocationName":
                newLocationName = value;
                break;
            case "newLocationShortName":
                newLocationShortName = value;
                break;
            case "newLocationConfig":
                newLocationConfig = value;
                break;
            case "newOrgName":
                newOrgName = value;
                break;
            case "newOrgShortName":
                newOrgShortName = value;
                break;
            case "newOrgConfig":
                newOrgConfig = value;
                break;
            case "newProjAppSvcName":
                newProjAppSvcName = value;
                break;
            case "newProjAppSvcShortName":
                newProjAppSvcShortName = value;
                break;
            case "newProjAppSvcConfig":
                newProjAppSvcConfig = value;
                break;
            case "newTypeConfig":
                newTypeConfig = value;
                break;
            case "newUnitDeptName":
                newUnitDeptName = value;
                break;
            case "newUnitDeptShortName":
                newUnitDeptShortName = value;
                break;
            case "newUnitDeptConfig":
                newUnitDeptConfig = value;
                break;
            case "newFunctionName":
                newFunctionName = value;
                break;
            case "newFunctionShortName":
                newFunctionShortName = value;
                break;
            case "newFunctionConfig":
                newFunctionConfig = value;
                break;
            case "newCustomComponentConfig":
                newCustomComponentConfig = value;
                break;
            case "newGlobalConfig":
                newGlobalConfig = value;
                break;
        }
    }

    private void OnCategoryChanged(ChangeEventArgs e)
    {
        selectedResourceTypeCategory = e.Value!.ToString()!;

    }

    private async void OnTypeChanged(ChangeEventArgs e)
    {
        await JsRuntime.InvokeVoidAsync("scrollIntoView", e.Value!.ToString()!);
    }

    private void OnInstructionsClick()
    {
        NavigationManager.NavigateTo("instructions");
    }

    private async Task OnConfigurationAlertDismissed()
    {
        versionalertshown = true;
        await session.SetAsync("versionalert-" + appversion + "-shown", true);
        if (dismissalert)
        {
            ConfigurationHelper.DismissVersionAlert();
        }
        StateHasChanged();
    }
    private async Task OnConnectivtyAlertDismissed()
    {
        await session.SetAsync("connectivityalertshown", true);
    }

    private void OnRefreshLocationsCheckboxClicked(ChangeEventArgs e)
    {
        if (GeneralHelper.IsNotNull(e.Value))
        {
            refreshlocationshortnames = bool.Parse(e.Value.ToString()!);
            if (refreshlocationshortnames)
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the Locations short names and details to match the latest Azure Naming Tool values and cannot be undone!</div>", "", admin);
            }
        }
    }

    private void OnRefreshTypesCheckboxClicked(ChangeEventArgs e)
    {
        if (GeneralHelper.IsNotNull(e.Value))
        {
            refreshtypeshortnames = bool.Parse(e.Value.ToString()!);
            if (refreshtypeshortnames)
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ATTENTION", "<div style='margin: 1.5rem 0;'>This will reset the Types short names and details to match the latest Azure Naming Tool values and cannot be undone!</div>", "", admin);
            }
        }
    }

    // ========== SQLite Backup/Restore Methods ==========

    private async Task DownloadDatabaseFile()
    {
        string? tempBackupPath = null;
        try
        {
            // Get the database path from configuration (e.g., "settings/azurenamingtool.db")
            string dbRelativePath = _config.GetValue<string>("StorageOptions:DatabasePath") ?? "settings/azurenamingtool.db";
            string dbPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, dbRelativePath);
            
            if (!File.Exists(dbPath))
            {
                await InvokeAsync(() =>
                {
                    ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ERROR", 
                        $"Database file not found at: {dbPath}. Ensure you are using SQLite storage.", "", admin);
                    StateHasChanged();
                });
                return;
            }

            // Create a temporary copy to avoid file lock issues
            // Use SQLite's VACUUM INTO command which creates a clean backup
            string dbDirectory = Path.GetDirectoryName(dbPath)!;
            tempBackupPath = Path.Combine(dbDirectory, $"temp_backup_{Guid.NewGuid()}.db");
            
            // Use VACUUM INTO to create a backup copy
            // This command creates a clean, defragmented copy of the database
            using (var connection = new Microsoft.Data.Sqlite.SqliteConnection($"Data Source={dbPath}"))
            {
                await connection.OpenAsync();
                using (var command = connection.CreateCommand())
                {
                    command.CommandText = $"VACUUM INTO '{tempBackupPath.Replace("\\", "\\\\")}'";
                    await command.ExecuteNonQueryAsync();
                }
                await connection.CloseAsync();
            }
            
            // Wait for file system to release handles
            await Task.Delay(500);
            
            // Read the backup file with retry logic
            byte[] fileBytes;
            int retryCount = 0;
            while (true)
            {
                try
                {
                    fileBytes = await File.ReadAllBytesAsync(tempBackupPath);
                    break;
                }
                catch (IOException) when (retryCount < 5)
                {
                    retryCount++;
                    await Task.Delay(200);
                }
            }
            string fileName = $"azurenamingtool-backup-{DateTime.Now:yyyyMMdd-HHmmss}.db";
            
            await BlazorDownloadFileService!.DownloadFile(fileName, fileBytes, "application/x-sqlite3");
            
            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-success", "SUCCESS", 
                    $"Database file downloaded successfully: {fileName}", "", admin);
                StateHasChanged();
            });

            // Log the backup
            AdminLogMessage adminLogMessage = new()
            {
                Title = "INFORMATION",
                Message = $"Database backup downloaded: {fileName} (Size: {FormatFileSize(fileBytes.Length)})"
            };
            await AdminLogService!.PostItemAsync(adminLogMessage);
        }
        catch (Exception ex)
        {
            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ERROR", 
                    $"Failed to download database file: {ex.Message}", "", admin);
                StateHasChanged();
            });

            AdminLogMessage adminLogMessage = new()
            {
                Title = "ERROR",
                Message = $"Database backup download failed: {ex.Message}"
            };
            await AdminLogService!.PostItemAsync(adminLogMessage);
        }
        finally
        {
            // Clean up temporary backup file with retry logic
            if (!string.IsNullOrEmpty(tempBackupPath) && File.Exists(tempBackupPath))
            {
                // Try to delete with retries (file handles may still be releasing)
                for (int i = 0; i < 5; i++)
                {
                    try
                    {
                        // Force garbage collection to release any lingering handles
                        GC.Collect();
                        GC.WaitForPendingFinalizers();
                        
                        await Task.Delay(200);
                        File.Delete(tempBackupPath);
                        break; // Success
                    }
                    catch (IOException) when (i < 4)
                    {
                        // File still locked, wait and retry
                        await Task.Delay(500);
                    }
                    catch (Exception ex) when (i == 4)
                    {
                        // Final attempt failed, log but don't throw
                        Logger.LogWarning(ex, "Failed to delete temporary backup file after {Attempts} attempts: {TempPath}", i + 1, tempBackupPath);
                    }
                }
            }
        }
    }

    private async Task ExportConfigurationAsJson()
    {
        try
        {
            var response = await ImportExportService!.ExportConfigAsync(includeAdmin);
            if (!response.Success || response.ResponseObject == null)
            {
                throw new Exception("Failed to export configuration data");
            }

            string jsonData = System.Text.Json.JsonSerializer.Serialize(response.ResponseObject);
            string fileName = $"azurenamingtool-config-{DateTime.Now:yyyyMMdd-HHmmss}.json";
            byte[] fileBytes = System.Text.Encoding.UTF8.GetBytes(jsonData);
            
            await BlazorDownloadFileService!.DownloadFile(fileName, fileBytes, "application/json");
            
            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-success", "SUCCESS", 
                    $"Configuration exported successfully: {fileName}", "", admin);
                StateHasChanged();
            });

            // Log the export
            AdminLogMessage adminLogMessage = new()
            {
                Title = "INFORMATION",
                Message = $"Configuration JSON export: {fileName} (Size: {FormatFileSize(fileBytes.Length)}, Include Admin: {includeAdmin})"
            };
            await AdminLogService!.PostItemAsync(adminLogMessage);
        }
        catch (Exception ex)
        {
            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ERROR", 
                    $"Failed to export configuration: {ex.Message}", "", admin);
                StateHasChanged();
            });

            AdminLogMessage adminLogMessage = new()
            {
                Title = "ERROR",
                Message = $"Configuration JSON export failed: {ex.Message}"
            };
            await AdminLogService!.PostItemAsync(adminLogMessage);
        }
    }

    private void HandleSQLiteDatabaseUpload(InputFileChangeEventArgs e)
    {
        sqliteBackupFile = e.File;
        StateHasChanged();
    }

    private void HandleJsonConfigUpload(InputFileChangeEventArgs e)
    {
        jsonBackupFile = e.File;
        StateHasChanged();
    }

    private async Task RestoreFromSQLiteBackup()
    {
        if (sqliteBackupFile == null)
        {
            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-warning", "WARNING", 
                    "Please select a database file to restore.", "", admin);
                StateHasChanged();
            });
            return;
        }

        // Validate file extension
        if (!sqliteBackupFile.Name.EndsWith(".db", StringComparison.OrdinalIgnoreCase))
        {
            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ERROR", 
                    "Invalid file type. Please select a .db file.", "", admin);
                StateHasChanged();
            });
            return;
        }

        // Show text confirmation modal (user must type RESTORE to confirm)
        string confirmMessage = $"<div style='margin: 1.5rem 0;'>" +
            $"<p>You are about to restore the database from:</p>" +
            $"<p><strong>{sqliteBackupFile.Name}</strong> ({FormatFileSize(sqliteBackupFile.Size)})</p>" +
            $"<p class=\"text-danger mt-3\"><strong> WARNING:</strong> This will completely replace your current database!</p>" +
            $"<ul class=\"text-danger text-start\">" +
            $"<li>All current data will be lost</li>" +
            $"<li>A pre-restore backup will be created automatically</li>" +
            $"<li>The application will restart immediately</li>" +
            $"<li><strong>All active users will be disconnected</strong></li>" +
            $"</ul>" +
            $"<p class=\"text-info mt-3\"><i class=\"bi bi-info-circle\"></i> The restore process will:</p>" +
            $"<ol class=\"text-start\">" +
            $"<li>Create a backup of your current database</li>" +
            $"<li>Prepare the uploaded database for restore</li>" +
            $"<li>Automatically restart the application</li>" +
            $"<li>Complete the restore on startup</li>" +
            $"</ol>" +
            $"<p class=\"mt-3\">This is a critical administrative operation.</p></div>";

        bool confirmed = await ModalHelper.ShowTextConfirmationModal(
            Modal!, 
            "Confirm Database Restore", 
            confirmMessage, 
            "CONFIRM", 
            "bg-warning", 
            theme
        );

        if (!confirmed)
        {
            return;
        }

        try
        {
            // Get the database path from configuration (e.g., "settings/azurenamingtool.db")
            string dbRelativePath = _config.GetValue<string>("StorageOptions:DatabasePath") ?? "settings/azurenamingtool.db";
            string dbPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, dbRelativePath);
            
            // Ensure the settings directory exists
            string dbDirectory = Path.GetDirectoryName(dbPath)!;
            if (!Directory.Exists(dbDirectory))
            {
                Directory.CreateDirectory(dbDirectory);
            }
            
            // Save uploaded file as pending restore
            string pendingRestorePath = Path.Combine(dbDirectory, "azurenamingtool-pending-restore.db");
            string backupPath = Path.Combine(dbDirectory, $"azurenamingtool-prerestore-{DateTime.Now:yyyyMMdd-HHmmss}.db");

            // Create a backup of the current database before restoring
            if (File.Exists(dbPath))
            {
                File.Copy(dbPath, backupPath, true);
            }

            // Save the uploaded file as pending restore
            using (var stream = sqliteBackupFile.OpenReadStream(maxAllowedSize: 50 * 1024 * 1024)) // 50MB max
            {
                using (var fileStream = new FileStream(pendingRestorePath, FileMode.Create))
                {
                    await stream.CopyToAsync(fileStream);
                }
            }
            
            // Create a flag file to indicate pending restore
            string flagPath = Path.Combine(dbDirectory, "restore-pending.flag");
            await File.WriteAllTextAsync(flagPath, $"Restore from: {sqliteBackupFile.Name}\nTimestamp: {DateTime.Now:yyyy-MM-dd HH:mm:ss}\nBackup: {Path.GetFileName(backupPath)}");

            // Log the restore preparation
            AdminLogMessage adminLogMessage = new()
            {
                Title = "INFORMATION",
                Message = $"Database restore prepared from: {sqliteBackupFile.Name} (Size: {FormatFileSize(sqliteBackupFile.Size)}). Pre-restore backup saved. Restart required."
            };
            await AdminLogService!.PostItemAsync(adminLogMessage);

            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-success", "RESTORE PREPARED", 
                    $"<div style='margin: 1.5rem 0;'>" +
                    $"<p><i class=\"bi bi-check-circle\"></i> Database restore has been prepared successfully!</p>" +
                    $"<p class=\"text-info\"><strong>Pre-restore backup:</strong> {Path.GetFileName(backupPath)}</p>" +
                    $"<hr class=\"my-3\"/>" +
                    $"<p><i class=\"bi bi-arrow-repeat\"></i> <strong>The application will restart in 3 seconds...</strong></p>" +
                    $"<p class=\"text-warning\"><i class=\"bi bi-exclamation-triangle\"></i> <strong>Development Mode:</strong></p>" +
                    $"<ul class=\"text-start text-warning\">" +
                    $"<li>The application will stop</li>" +
                    $"<li>Restart it manually with: <code>dotnet run</code></li>" +
                    $"<li>Then refresh this page</li>" +
                    $"</ul>" +
                    $"<p class=\"text-muted small\"><strong>Production Mode:</strong> The application will restart automatically and this page will reload.</p></div>", 
                    "", admin);
                StateHasChanged();
            });

            // Add JavaScript to attempt auto-reload when server comes back
            await JsRuntime.InvokeVoidAsync("eval", @"
                setTimeout(function() {
                    var checkInterval = setInterval(function() {
                        fetch('/')
                            .then(function(response) {
                                if (response.ok) {
                                    clearInterval(checkInterval);
                                    window.location.href = '/';
                                }
                            })
                            .catch(function() {
                                // Server still down, keep checking
                            });
                    }, 2000);
                }, 3000);
            ");

            // Trigger application restart - the restore will complete on startup
            await Task.Delay(3000);
            AppLifetime.StopApplication();
        }
        catch (Exception ex)
        {
            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ERROR", 
                    $"Failed to restore database: {ex.Message}", "", admin);
                StateHasChanged();
            });

            AdminLogMessage adminLogMessage = new()
            {
                Title = "ERROR",
                Message = $"Database restore failed: {ex.Message}"
            };
            await AdminLogService!.PostItemAsync(adminLogMessage);
        }
    }

    private async Task RestoreFromJsonBackup()
    {
        if (jsonBackupFile == null)
        {
            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-warning", "WARNING", 
                    "Please select a JSON file to restore.", "", admin);
                StateHasChanged();
            });
            return;
        }

        // Validate file extension
        if (!jsonBackupFile.Name.EndsWith(".json", StringComparison.OrdinalIgnoreCase))
        {
            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ERROR", 
                    "Invalid file type. Please select a .json file.", "", admin);
                StateHasChanged();
            });
            return;
        }

        // Show confirmation modal
        string confirmMessage = $"<div style='margin: 1.5rem 0;'><p>You are about to restore configuration from:</p>" +
            $"<p><strong>{jsonBackupFile.Name}</strong> ({FormatFileSize(jsonBackupFile.Size)})</p>" +
            $"<p class=\"text-warning\"><strong>NOTE:</strong> This will overwrite your current configuration data!</p>" +
            $"<p>This works with both pre-migration and post-migration JSON exports.</p>" +
            $"<p>Do you want to proceed?</p></div>";

        bool confirmed = await ModalHelper.ShowConfirmationModal(Modal!, "Confirm JSON Restore", confirmMessage, "bg-warning", theme);

        if (!confirmed)
        {
            return;
        }

        try
        {
            // Read the uploaded JSON file
            string jsonContent;
            using (var stream = jsonBackupFile.OpenReadStream(maxAllowedSize: 10 * 1024 * 1024)) // 10MB max
            {
                using (var reader = new StreamReader(stream))
                {
                    jsonContent = await reader.ReadToEndAsync();
                }
            }

            // Validate JSON format
            ConfigurationData? configData;
            try
            {
                configData = System.Text.Json.JsonSerializer.Deserialize<ConfigurationData>(jsonContent);
                if (configData == null)
                {
                    throw new Exception("Deserialized configuration data is null.");
                }
            }
            catch (Exception ex)
            {
                await InvokeAsync(() =>
                {
                    ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ERROR", 
                        $"Invalid JSON format: {ex.Message}", "", admin);
                    StateHasChanged();
                });
                return;
            }

            // Import the configuration using the existing ImportExportService
            var result = await ImportExportService!.PostConfigAsync(configData);

            if (result.Success)
            {
                await InvokeAsync(() =>
                {
                    ModalHelper.ShowInformationModal(Modal!, theme, "bg-success", "SUCCESS", 
                        $"<div style='margin: 1.5rem 0;'><p>Configuration restored successfully from JSON!</p>" +
                        $"<p>The page will refresh in 2 seconds...</p></div>", "", admin);
                    StateHasChanged();
                });

                // Log the restore
                AdminLogMessage adminLogMessage = new()
                {
                    Title = "INFORMATION",
                    Message = $"Configuration restored from JSON: {jsonBackupFile.Name} (Size: {FormatFileSize(jsonBackupFile.Size)})"
                };
                await AdminLogService!.PostItemAsync(adminLogMessage);

                // Refresh the page
                await Task.Delay(2000);
                NavigationManager!.NavigateTo("/configuration", true);
            }
            else
            {
                await InvokeAsync(() =>
                {
                    ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ERROR", 
                        "Failed to restore configuration from JSON. Check the log for details.", "", admin);
                    StateHasChanged();
                });

                AdminLogMessage adminLogMessage = new()
                {
                    Title = "ERROR",
                    Message = $"Configuration restore from JSON failed: {jsonBackupFile.Name}"
                };
                await AdminLogService!.PostItemAsync(adminLogMessage);
            }
        }
        catch (Exception ex)
        {
            await InvokeAsync(() =>
            {
                ModalHelper.ShowInformationModal(Modal!, theme, "bg-danger", "ERROR", 
                    $"Failed to restore configuration: {ex.Message}", "", admin);
                StateHasChanged();
            });

            AdminLogMessage adminLogMessage = new()
            {
                Title = "ERROR",
                Message = $"Configuration restore from JSON failed: {ex.Message}"
            };
            await AdminLogService!.PostItemAsync(adminLogMessage);
        }
    }

    private string FormatFileSize(long bytes)
    {
        string[] sizes = { "B", "KB", "MB", "GB" };
        double len = bytes;
        int order = 0;
        while (len >= 1024 && order < sizes.Length - 1)
        {
            order++;
            len = len / 1024;
        }
        return $"{len:0.##} {sizes[order]}";
    }

    private async Task<(bool Success, string Message, string? Details)> ResetConfigurationData<T>(string repositoryFileName, Func<List<T>, Task<ServiceResponse>> postConfigAsync)
    {
        try
        {
            if (isUsingSQLite)
            {
                // For SQLite: Load from repository JSON and save to database
                var repositoryPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "repository", repositoryFileName);
                
                // Log the reset attempt
                await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                { 
                    Title = "INFORMATION", 
                    Message = $"Reset configuration attempt for: {repositoryFileName}, Path: {repositoryPath}" 
                });
                
                if (File.Exists(repositoryPath))
                {
                    var jsonContent = await File.ReadAllTextAsync(repositoryPath);
                    JsonSerializerOptions options = new JsonSerializerOptions
                    {
                        PropertyNameCaseInsensitive = true
                    };
                    var resetItems = JsonSerializer.Deserialize<List<T>>(jsonContent, options);
                    if (resetItems != null)
                    {
                        await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                        { 
                            Title = "INFORMATION", 
                            Message = $"Loaded {resetItems.Count} items from {repositoryFileName}. Calling PostConfigAsync..." 
                        });
                        
                        var serviceResponse = await postConfigAsync(resetItems);
                        
                        await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                        { 
                            Title = serviceResponse.Success ? "SUCCESS" : "ERROR", 
                            Message = $"PostConfigAsync result: Success={serviceResponse.Success}, Message={serviceResponse.ResponseMessage}" 
                        });
                        
                        if (serviceResponse.Success)
                        {
                            return (true, "Configuration reset successfully!", null);
                        }
                        else
                        {
                            return (false, "Configuration reset failed! Please check the Admin Log for details.", serviceResponse.ResponseMessage);
                        }
                    }
                    else
                    {
                        return (false, "Configuration reset failed! Could not deserialize repository data.", null);
                    }
                }
                else
                {
                    return (false, $"Configuration reset failed! Repository file not found: {repositoryPath}", null);
                }
            }
            else
            {
                // For FileSystem: Copy file from repository and reload data
                if (FileSystemHelper.ResetConfiguration(repositoryFileName))
                {
                    // Now load the reset data and refresh the cache via PostConfigAsync
                    var settingsPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "settings", repositoryFileName);
                    
                    await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                    { 
                        Title = "INFORMATION", 
                        Message = $"FileSystem reset: File copied. Loading from: {settingsPath}" 
                    });
                    
                    if (File.Exists(settingsPath))
                    {
                        var jsonContent = await File.ReadAllTextAsync(settingsPath);
                        JsonSerializerOptions options = new JsonSerializerOptions
                        {
                            PropertyNameCaseInsensitive = true
                        };
                        var resetItems = JsonSerializer.Deserialize<List<T>>(jsonContent, options);
                        if (resetItems != null)
                        {
                            await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                            { 
                                Title = "INFORMATION", 
                                Message = $"FileSystem reset: Loaded {resetItems.Count} items. Calling PostConfigAsync to refresh cache..." 
                            });
                            
                            var serviceResponse = await postConfigAsync(resetItems);
                            
                            await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                            { 
                                Title = serviceResponse.Success ? "SUCCESS" : "ERROR", 
                                Message = $"FileSystem reset PostConfigAsync result: Success={serviceResponse.Success}, Message={serviceResponse.ResponseMessage}" 
                            });
                            
                            if (serviceResponse.Success)
                            {
                                return (true, "Configuration reset successfully!", null);
                            }
                            else
                            {
                                return (false, "Configuration reset failed during cache refresh! Please check the Admin Log for details.", serviceResponse.ResponseMessage);
                            }
                        }
                        else
                        {
                            return (false, "Configuration reset failed! Could not deserialize settings data.", null);
                        }
                    }
                    else
                    {
                        return (false, $"Configuration reset failed! Settings file not found after copy: {settingsPath}", null);
                    }
                }
                else
                {
                    return (false, "Configuration reset failed! Could not copy repository file. Please check the Admin Log for details.", null);
                }
            }
        }
        catch (Exception ex)
        {
            await AdminLogService!.PostItemAsync(new AdminLogMessage() 
            { 
                Title = "ERROR", 
                Message = $"Reset configuration exception: {ex.Message}\nStackTrace: {ex.StackTrace}" 
            });
            return (false, $"Configuration reset failed: {ex.Message}", ex.StackTrace);
        }
    }

    /// <summary>
    /// Converts the ShortName property of items to uppercase or lowercase and persists changes using the provided service.
    /// </summary>
    /// <typeparam name="T">Type of items to convert</typeparam>
    /// <param name="items">List of items to convert</param>
    /// <param name="lowercase">True for lowercase, false for uppercase</param>
    /// <param name="postItemFunc">Function to call to persist each item</param>
    /// <returns>ServiceResponse indicating success or failure</returns>
    private async Task<ServiceResponse> ConvertCaseAsync<T>(List<T> items, bool lowercase, Func<T, Task<ServiceResponse>> postItemFunc)
    {
        ServiceResponse serviceResponse = new() { Success = true };
        try
        {
            foreach (dynamic item in items)
            {
                // Update the ShortName property
                item!.ShortName = lowercase ? item.ShortName.ToLower() : item.ShortName.ToUpper();
                
                // Persist the change using the provided service function
                serviceResponse = await postItemFunc(item);
                
                // Stop if any save fails
                if (!serviceResponse.Success)
                {
                    await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                    { 
                        Title = "ERROR", 
                        Message = $"Convert case failed for item: {item.ShortName}. Error: {serviceResponse.ResponseMessage}" 
                    });
                    break;
                }
            }
            
            if (serviceResponse.Success)
            {
                await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                { 
                    Title = "INFORMATION", 
                    Message = $"Successfully converted {items.Count} items to {(lowercase ? "lowercase" : "uppercase")}" 
                });
            }
        }
        catch (Exception ex)
        {
            serviceResponse.Success = false;
            serviceResponse.ResponseMessage = ex.Message;
            await AdminLogService!.PostItemAsync(new AdminLogMessage() 
            { 
                Title = "ERROR", 
                Message = $"Convert case exception: {ex.Message}" 
            });
        }
        return serviceResponse;
    }

    /// <summary>
    /// Reload only specific configuration tables instead of all data
    /// This improves performance by avoiding unnecessary database queries
    /// </summary>
    private async Task ReloadSpecificData(params string[] dataTypes)
    {
        ServiceResponse serviceResponse;
        foreach (var dataType in dataTypes)
        {
            try
            {
                switch (dataType)
            {
                case "ResourceComponent":
                    serviceResponse = await ResourceComponentService!.GetItemsAsync(admin);
                    if (serviceResponse.Success && GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                    {
                        servicesData.ResourceComponents = (List<ResourceComponent>)serviceResponse.ResponseObject!;
                    }
                    break;
                case "ResourceDelimiter":
                    serviceResponse = await ResourceDelimiterService!.GetItemsAsync(admin);
                    if (serviceResponse.Success && GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                    {
                        servicesData.ResourceDelimiters = (List<ResourceDelimiter>)serviceResponse.ResponseObject!;
                    }
                    break;
                case "ResourceEnvironment":
                    serviceResponse = await ResourceEnvironmentService!.GetItemsAsync();
                    if (serviceResponse.Success && GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                    {
                        servicesData.ResourceEnvironments = (List<ResourceEnvironment>)serviceResponse.ResponseObject!;
                    }
                    break;
                case "ResourceLocation":
                    serviceResponse = await ResourceLocationService!.GetItemsAsync(admin);
                    if (serviceResponse.Success && GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                    {
                        servicesData.ResourceLocations = (List<AzureNamingTool.Models.ResourceLocation>)serviceResponse.ResponseObject!;
                    }
                    break;
                case "ResourceOrg":
                    serviceResponse = await ResourceOrgService!.GetItemsAsync();
                    if (serviceResponse.Success && GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                    {
                        servicesData.ResourceOrgs = (List<ResourceOrg>)serviceResponse.ResponseObject!;
                    }
                    break;
                case "ResourceProjAppSvc":
                    serviceResponse = await ResourceProjAppSvcService!.GetItemsAsync();
                    if (serviceResponse.Success && GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                    {
                        servicesData.ResourceProjAppSvcs = (List<ResourceProjAppSvc>)serviceResponse.ResponseObject!;
                    }
                    break;
                case "ResourceType":
                    serviceResponse = await ResourceTypeService!.GetItemsAsync(admin);
                    if (serviceResponse.Success && GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                    {
                        servicesData.ResourceTypes = (List<ResourceType>)serviceResponse.ResponseObject!;
                        // Update categories when types change
                        categories = ResourceTypeService.GetTypeCategories(servicesData.ResourceTypes);
                    }
                    break;
                case "ResourceUnitDept":
                    serviceResponse = await ResourceUnitDeptService!.GetItemsAsync();
                    if (serviceResponse.Success && GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                    {
                        servicesData.ResourceUnitDepts = (List<ResourceUnitDept>)serviceResponse.ResponseObject!;
                    }
                    break;
                case "ResourceFunction":
                    serviceResponse = await ResourceFunctionService!.GetItemsAsync();
                    if (serviceResponse.Success && GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                    {
                        servicesData.ResourceFunctions = (List<ResourceFunction>)serviceResponse.ResponseObject!;
                    }
                    break;
                case "CustomComponent":
                    serviceResponse = await CustomComponentService!.GetItemsAsync();
                    if (serviceResponse.Success && GeneralHelper.IsNotNull(serviceResponse.ResponseObject))
                    {
                        servicesData.CustomComponents = (List<CustomComponent>)serviceResponse.ResponseObject!;
                    }
                    break;
            }
            }
            catch (Exception ex)
            {
                await AdminLogService!.PostItemAsync(new AdminLogMessage() 
                { 
                    Title = "ERROR", 
                    Message = $"ReloadSpecificData failed for {dataType}: {ex.Message}" 
                });
                throw; // Re-throw to be caught by outer try-catch
            }
        }
        StateHasChanged();
    }
}




















